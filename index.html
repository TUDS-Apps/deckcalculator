<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>TUDS Pro Deck Estimator</title>
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 32 32'%3E%3Crect width='32' height='32' rx='6' fill='%23294656'/%3E%3Cpath d='M6 10h20v3H6zM6 15h20v3H6zM6 20h20v3H6z' fill='%23F5E6D3'/%3E%3Cpath d='M10 8v18M16 8v18M22 8v18' stroke='%23294656' stroke-width='1.5'/%3E%3C/svg%3E">
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="deckcalculatorstyles.css" />
    <!-- PDF Export Libraries -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="deckCalcjs/app.js?v=9" type="module"></script>
  </head>
  <body class="bg-gray-200 p-4 md:p-8">
    <div class="container mx-auto max-w-7xl">
      <div class="deck-calculator-header">
        <div class="header-content">
          <img
            src="https://tuds.ca/cdn/shop/files/TUDS_logo.svg?v=1676653488"
            alt="The Ultimate Deck Shop"
            class="header-logo"
          />
          <div class="header-text">
            <h1 class="text-xl md:text-2xl font-bold text-white">
              TUDS Pro Deck Estimator
            </h1>
            <p class="header-subtitle">by The Ultimate Deck Shop</p>
          </div>
        </div>
        <div class="header-actions">
          <button type="button" id="adminBtn" class="header-action-btn" title="Admin Settings" onclick="openAdminLogin()">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-5 h-5">
              <path fill-rule="evenodd" d="M7.84 1.804A1 1 0 018.82 1h2.36a1 1 0 01.98.804l.331 1.652a6.993 6.993 0 011.929 1.115l1.598-.54a1 1 0 011.186.447l1.18 2.044a1 1 0 01-.205 1.251l-1.267 1.113a7.047 7.047 0 010 2.228l1.267 1.113a1 1 0 01.206 1.25l-1.18 2.045a1 1 0 01-1.187.447l-1.598-.54a6.993 6.993 0 01-1.929 1.115l-.33 1.652a1 1 0 01-.98.804H8.82a1 1 0 01-.98-.804l-.331-1.652a6.993 6.993 0 01-1.929-1.115l-1.598.54a1 1 0 01-1.186-.447l-1.18-2.044a1 1 0 01.205-1.251l1.267-1.114a7.05 7.05 0 010-2.227L1.821 7.773a1 1 0 01-.206-1.25l1.18-2.045a1 1 0 011.187-.447l1.598.54A6.993 6.993 0 017.51 3.456l.33-1.652zM10 13a3 3 0 100-6 3 3 0 000 6z" clip-rule="evenodd" />
            </svg>
            <span>Admin</span>
          </button>
          <button type="button" id="helpWizardBtn" class="help-wizard-trigger" title="Help & Tutorial" onclick="startHelpWizard()">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-5 h-5">
              <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zM8.94 6.94a.75.75 0 11-1.061-1.061 3 3 0 112.871 5.026v.345a.75.75 0 01-1.5 0v-.5c0-.72.57-1.172 1.081-1.287A1.5 1.5 0 108.94 6.94zM10 15a1 1 0 100-2 1 1 0 000 2z" clip-rule="evenodd" />
            </svg>
            <span>Help</span>
          </button>
        </div>
      </div>

      <!-- Main App Container -->
      <div id="main-layout-container" class="main-layout-with-sidebar">
        <!-- Skinny Vertical Step Sidebar -->
        <div class="step-sidebar">
          <ul id="wizardStepList" class="step-sidebar-list">
            <!-- Dynamically populated by JavaScript -->
          </ul>
        </div>

        <!-- Input Panel -->
        <div id="input-panel">
          <div class="info-card wizard-panel">

            <!-- Wizard Step Content Container -->
            <div class="wizard-content">

            <!-- Step 1: Draw Shape -->
            <div id="wizard-step-draw" class="wizard-step-content active">
              <h2 class="wizard-step-title">Draw Your Deck</h2>
              <div class="panel-content">

                <!-- Initial Instructions (hidden when shape is drawn) -->
                <div id="drawInstructionsPanel" class="draw-instructions-panel">
                  <p class="draw-instructions-text">Click on the canvas to draw a custom shape, enter dimensions below for a rectangle, or choose a template.</p>
                </div>

                <!-- Quick Rectangle Input (always visible until shape is drawn) -->
                <div id="quickDimensionsPanel" class="quick-dimensions-panel">
                  <div class="section-label">Quick Rectangle</div>
                  <div class="dimension-input-row">
                    <div class="dimension-field">
                      <label for="deckWidthInput">Width</label>
                      <div class="dimension-input-group">
                        <input type="number" id="deckWidthInput" min="4" max="100" value="16" step="1">
                        <span class="dimension-unit">ft</span>
                      </div>
                    </div>
                    <span class="dimension-separator">×</span>
                    <div class="dimension-field">
                      <label for="deckDepthInput">Depth</label>
                      <div class="dimension-input-group">
                        <input type="number" id="deckDepthInput" min="4" max="100" value="12" step="1">
                        <span class="dimension-unit">ft</span>
                      </div>
                    </div>
                  </div>
                  <button type="button" class="btn btn-primary btn-full-width" onclick="createRectangleFromDimensions()">
                    Create Rectangle
                  </button>
                </div>

                <!-- Template Gallery (always visible until shape is drawn) -->
                <div id="templatePanel" class="template-gallery-panel">
                  <div class="section-label">Templates</div>
                  <div class="template-grid" id="templateGrid">
                    <button type="button" class="template-card" onclick="loadTemplate('square')" title="Square 12x12">
                      <div class="template-preview">
                        <svg viewBox="0 0 60 40" class="template-svg">
                          <rect x="15" y="5" width="30" height="30" fill="none" stroke="currentColor" stroke-width="2"/>
                        </svg>
                      </div>
                      <span class="template-label">Square</span>
                      <span class="template-size">12' × 12'</span>
                    </button>
                    <button type="button" class="template-card" onclick="loadTemplate('rectangle-12x16')" title="Rectangle 12x16">
                      <div class="template-preview">
                        <svg viewBox="0 0 60 40" class="template-svg">
                          <rect x="8" y="8" width="44" height="24" fill="none" stroke="currentColor" stroke-width="2"/>
                        </svg>
                      </div>
                      <span class="template-label">Rectangle</span>
                      <span class="template-size">12' × 16'</span>
                    </button>
                    <button type="button" class="template-card" onclick="loadTemplate('l-shape-left')" title="L-Shape (Left)">
                      <div class="template-preview">
                        <svg viewBox="0 0 60 40" class="template-svg">
                          <path d="M8 6 L8 34 L36 34 L36 20 L52 20 L52 6 Z" fill="none" stroke="currentColor" stroke-width="2"/>
                        </svg>
                      </div>
                      <span class="template-label">L-Shape</span>
                      <span class="template-size">Left</span>
                    </button>
                    <button type="button" class="template-card" onclick="loadTemplate('l-shape-right')" title="L-Shape (Right)">
                      <div class="template-preview">
                        <svg viewBox="0 0 60 40" class="template-svg">
                          <path d="M8 6 L8 20 L24 20 L24 34 L52 34 L52 6 Z" fill="none" stroke="currentColor" stroke-width="2"/>
                        </svg>
                      </div>
                      <span class="template-label">L-Shape</span>
                      <span class="template-size">Right</span>
                    </button>
                    <button type="button" class="template-card" onclick="loadTemplate('u-shape')" title="U-Shape Wrap">
                      <div class="template-preview">
                        <svg viewBox="0 0 60 40" class="template-svg">
                          <path d="M6 6 L6 34 L54 34 L54 6 L40 6 L40 22 L20 22 L20 6 Z" fill="none" stroke="currentColor" stroke-width="2"/>
                        </svg>
                      </div>
                      <span class="template-label">U-Shape</span>
                      <span class="template-size">Wrap</span>
                    </button>
                    <button type="button" class="template-card" onclick="loadTemplate('notched')" title="Notched Corner (Right)">
                      <div class="template-preview">
                        <svg viewBox="0 0 60 40" class="template-svg">
                          <path d="M8 6 L8 34 L52 34 L52 18 L36 18 L36 6 Z" fill="none" stroke="currentColor" stroke-width="2"/>
                        </svg>
                      </div>
                      <span class="template-label">Notched</span>
                      <span class="template-size">Right</span>
                    </button>
                    <button type="button" class="template-card" onclick="loadTemplate('notched-left')" title="Notched Corner (Left)">
                      <div class="template-preview">
                        <svg viewBox="0 0 60 40" class="template-svg">
                          <path d="M24 6 L24 18 L8 18 L8 34 L52 34 L52 6 Z" fill="none" stroke="currentColor" stroke-width="2"/>
                        </svg>
                      </div>
                      <span class="template-label">Notched</span>
                      <span class="template-size">Left</span>
                    </button>
                    <button type="button" class="template-card" onclick="loadTemplate('diagonal-corners')" title="Chamfered Corners">
                      <div class="template-preview">
                        <svg viewBox="0 0 60 40" class="template-svg">
                          <path d="M15 6 L45 6 L52 13 L52 34 L8 34 L8 13 Z" fill="none" stroke="currentColor" stroke-width="2"/>
                        </svg>
                      </div>
                      <span class="template-label">Chamfered</span>
                      <span class="template-size">Clipped Corners</span>
                    </button>
                    <button type="button" class="template-card" onclick="loadTemplate('bay-window')" title="Bay Window Bump-out">
                      <div class="template-preview">
                        <svg viewBox="0 0 60 40" class="template-svg">
                          <path d="M8 10 L20 10 L17 6 L43 6 L40 10 L52 10 L52 34 L8 34 Z" fill="none" stroke="currentColor" stroke-width="2"/>
                        </svg>
                      </div>
                      <span class="template-label">Bay Window</span>
                      <span class="template-size">Bump-out</span>
                    </button>
                  </div>
                </div>

                <!-- Edit Shape Panel (shown when shape is closed) -->
                <div id="editShapePanel" class="edit-shape-panel hidden">
                  <button type="button" id="editShapeBtn" class="btn btn-secondary btn-full-width edit-shape-btn" onclick="toggleShapeEditMode()">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="btn-icon">
                      <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/>
                      <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"/>
                    </svg>
                    <span>Edit Shape</span>
                  </button>
                  <p id="editShapeHint" class="edit-shape-hint hidden">Drag corners to move • Drag edges to resize • Click <span class="icon-hint">+</span> to add point • Click <span class="icon-hint">×</span> to remove</p>
                </div>

                <!-- Wall Selection (shown when shape is closed and needs wall selection) -->
                <div id="drawStepWallSelection" class="wall-selection-inline hidden">
                  <div class="instruction-box instruction-box-highlight">
                    <div class="instruction-header">
                      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="instruction-icon">
                        <path d="M15 3h4a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2h-4"/>
                        <polyline points="10 17 15 12 10 7"/>
                        <line x1="15" y1="12" x2="3" y2="12"/>
                      </svg>
                      <span class="instruction-title">Select Wall</span>
                    </div>
                    <p>Click wall edge(s) that will be attached to your house. You can select multiple parallel walls.</p>
                  </div>
                </div>

                <!-- Next Button for Step 1 -->
                <div class="wizard-step-actions">
                  <button type="button" id="wizardNextBtn" class="btn btn-primary btn-full-width wizard-next-btn" onclick="goToNextStep()" disabled>
                    <span>Next: Structure</span>
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-4 h-4">
                      <path fill-rule="evenodd" d="M3 10a.75.75 0 01.75-.75h10.638L10.23 5.29a.75.75 0 111.04-1.08l5.5 5.25a.75.75 0 010 1.08l-5.5 5.25a.75.75 0 11-1.04-1.08l4.158-3.96H3.75A.75.75 0 013 10z" clip-rule="evenodd" />
                    </svg>
                  </button>
                </div>
              </div>
            </div>

            <!-- Step 2: Structure & Height -->
            <div id="wizard-step-structure" class="wizard-step-content hidden">
              <h2 class="wizard-step-title">Structure & Height</h2>

              <!-- Sub-step indicator -->
              <div class="substep-indicator">
                <button type="button" class="substep-dot active" data-substep="1" onclick="setStructureSubstep(1)">
                  <span class="substep-num">1</span>
                  <span class="substep-label">Foundation</span>
                </button>
                <div class="substep-connector"></div>
                <button type="button" class="substep-dot" data-substep="2" onclick="setStructureSubstep(2)">
                  <span class="substep-num">2</span>
                  <span class="substep-label">Framing</span>
                </button>
                <div class="substep-connector"></div>
                <button type="button" class="substep-dot" data-substep="3" onclick="setStructureSubstep(3)">
                  <span class="substep-num">3</span>
                  <span class="substep-label">Finishing</span>
                </button>
              </div>

              <div class="panel-content">
                <div class="deck-specifications">
                  <form id="deckSpecsForm" class="space-y-4">

                    <!-- Sub-step 1: Foundation -->
                    <div id="structure-substep-1" class="structure-substep active" data-substep="1">
                    <!-- Deck Height Input -->
                    <div class="deck-height-input">
                      <div class="visual-selector-label">
                        Deck Height
                      </div>
                      <div class="height-input-group">
                        <div class="height-input-field">
                          <select
                            id="deckHeightFeet"
                            name="deckHeightFeet"
                            class="height-select"
                            aria-label="Deck height in feet"
                          >
                            <option value="1">1</option>
                            <option value="2">2</option>
                            <option value="3">3</option>
                            <option value="4" selected>4</option>
                            <option value="5">5</option>
                            <option value="6">6</option>
                            <option value="7">7</option>
                            <option value="8">8</option>
                            <option value="9">9</option>
                            <option value="10">10</option>
                            <option value="11">11</option>
                            <option value="12">12</option>
                          </select>
                          <span class="height-unit">ft</span>
                        </div>
                        <div class="height-input-field">
                          <select
                            id="deckHeightInchesInput"
                            name="deckHeightInchesInput"
                            class="height-select"
                            aria-label="Deck height in inches"
                          >
                            <option value="0" selected>0</option>
                            <option value="1">1</option>
                            <option value="2">2</option>
                            <option value="3">3</option>
                            <option value="4">4</option>
                            <option value="5">5</option>
                            <option value="6">6</option>
                            <option value="7">7</option>
                            <option value="8">8</option>
                            <option value="9">9</option>
                            <option value="10">10</option>
                            <option value="11">11</option>
                          </select>
                          <span class="height-unit">in</span>
                        </div>
                      </div>
                    </div>
                    <!-- Footing Type Visual Selector -->
                    <div class="visual-selector compact" data-selector="footingType">
                      <div class="visual-selector-label">
                        Footing Type
                      </div>
                      <div class="visual-selector-grid three-col">
                        <div class="visual-option selected" data-value="gh_levellers">
                          <div class="visual-option-icon">
                            <svg viewBox="0 0 36 36" fill="none" stroke="currentColor" stroke-width="2">
                              <rect x="6" y="24" width="24" height="6" rx="1"/>
                              <rect x="12" y="16" width="12" height="8"/>
                              <line x1="18" y1="8" x2="18" y2="16"/>
                              <circle cx="18" cy="6" r="2"/>
                            </svg>
                          </div>
                          <div class="visual-option-name">GH Levellers</div>
                          <div class="visual-option-desc">+ 16x16 Slab</div>
                        </div>
                        <div class="visual-option" data-value="pylex">
                          <div class="visual-option-icon">
                            <svg viewBox="0 0 36 36" fill="none" stroke="currentColor" stroke-width="2">
                              <path d="M18 6 L18 30"/>
                              <path d="M14 28 L18 34 L22 28"/>
                              <path d="M12 10 L24 10"/>
                              <circle cx="18" cy="6" r="2"/>
                            </svg>
                          </div>
                          <div class="visual-option-name">Pylex</div>
                          <div class="visual-option-desc">50" Screw Piles</div>
                        </div>
                        <div class="visual-option" data-value="helical">
                          <div class="visual-option-icon">
                            <svg viewBox="0 0 36 36" fill="none" stroke="currentColor" stroke-width="2">
                              <path d="M18 4 L18 32"/>
                              <ellipse cx="18" cy="28" rx="8" ry="3"/>
                              <ellipse cx="18" cy="22" rx="6" ry="2"/>
                              <rect x="14" y="2" width="8" height="4"/>
                            </svg>
                          </div>
                          <div class="visual-option-name">Helical</div>
                          <div class="visual-option-desc">10' Piles</div>
                        </div>
                      </div>
                      <select id="footingType" name="footingType" class="hidden-select" aria-label="Footing type">
                        <option value="gh_levellers" selected>GH Levellers + 16x16 Slab</option>
                        <option value="pylex">Pylex 50" Screw Piles</option>
                        <option value="helical">10' Helical Piles</option>
                      </select>
                    </div>
                    <!-- Post Size Visual Selector -->
                    <div class="visual-selector compact" data-selector="postSize">
                      <div class="visual-selector-label">
                        Post Size
                      </div>
                      <div class="visual-selector-grid three-col">
                        <div class="visual-option selected" data-value="auto">
                          <div class="visual-option-icon">
                            <svg viewBox="0 0 36 36" fill="none" stroke="currentColor" stroke-width="2">
                              <rect x="14" y="8" width="8" height="20" rx="1"/>
                              <circle cx="18" cy="5" r="3"/>
                              <path d="M12 18 L8 18 M24 18 L28 18" stroke-dasharray="2 2"/>
                            </svg>
                          </div>
                          <div class="visual-option-name">Auto</div>
                          <div class="visual-option-desc">App Decides</div>
                        </div>
                        <div class="visual-option" data-value="4x4">
                          <div class="visual-option-icon">
                            <svg viewBox="0 0 36 36" fill="none" stroke="currentColor" stroke-width="2">
                              <rect x="13" y="6" width="10" height="24" rx="1"/>
                              <text x="18" y="21" font-size="8" text-anchor="middle" fill="currentColor" stroke="none">4x4</text>
                            </svg>
                          </div>
                          <div class="visual-option-name">4x4</div>
                          <div class="visual-option-desc">2-ply beams</div>
                        </div>
                        <div class="visual-option" data-value="6x6">
                          <div class="visual-option-icon">
                            <svg viewBox="0 0 36 36" fill="none" stroke="currentColor" stroke-width="2">
                              <rect x="10" y="6" width="16" height="24" rx="1"/>
                              <text x="18" y="21" font-size="8" text-anchor="middle" fill="currentColor" stroke="none">6x6</text>
                            </svg>
                          </div>
                          <div class="visual-option-name">6x6</div>
                          <div class="visual-option-desc">3-ply beams</div>
                        </div>
                      </div>
                      <select id="postSize" name="postSize" class="hidden-select" aria-label="Post size">
                        <option value="auto" selected>App Decides</option>
                        <option value="4x4">4x4 Posts (2-ply beams)</option>
                        <option value="6x6">6x6 Posts (3-ply beams)</option>
                      </select>
                    </div>
                    </div><!-- End Sub-step 1: Foundation -->

                    <!-- Sub-step 2: Framing -->
                    <div id="structure-substep-2" class="structure-substep" data-substep="2">
                    <!-- Joist Spacing Visual Selector -->
                    <div class="visual-selector compact" data-selector="joistSpacing">
                      <div class="visual-selector-label">
                        Joist Spacing
                      </div>
                      <div class="visual-selector-grid two-col">
                        <div class="visual-option selected" data-value="16">
                          <div class="visual-option-icon">
                            <svg viewBox="0 0 36 36" fill="none" stroke="currentColor" stroke-width="2">
                              <rect x="4" y="6" width="3" height="24"/>
                              <rect x="16" y="6" width="3" height="24"/>
                              <rect x="28" y="6" width="3" height="24"/>
                              <path d="M7 30 L16 30" stroke-width="1"/>
                              <path d="M5.5 28 L5.5 32 M17.5 28 L17.5 32" stroke-width="1"/>
                            </svg>
                          </div>
                          <div class="visual-option-name">16" OC</div>
                          <div class="visual-option-desc">Standard</div>
                        </div>
                        <div class="visual-option" data-value="12">
                          <div class="visual-option-icon">
                            <svg viewBox="0 0 36 36" fill="none" stroke="currentColor" stroke-width="2">
                              <rect x="2" y="6" width="3" height="24"/>
                              <rect x="11" y="6" width="3" height="24"/>
                              <rect x="20" y="6" width="3" height="24"/>
                              <rect x="29" y="6" width="3" height="24"/>
                              <path d="M5 30 L11 30" stroke-width="1"/>
                              <path d="M3.5 28 L3.5 32 M12.5 28 L12.5 32" stroke-width="1"/>
                            </svg>
                          </div>
                          <div class="visual-option-name">12" OC</div>
                          <div class="visual-option-desc">Heavy Duty</div>
                        </div>
                      </div>
                      <select id="joistSpacing" name="joistSpacing" class="hidden-select" aria-label="Joist spacing">
                        <option value="16" selected>16" OC</option>
                        <option value="12">12" OC</option>
                      </select>
                    </div>
                    <!-- Attachment Type Visual Selector -->
                    <div class="visual-selector compact" data-selector="attachmentType">
                      <div class="visual-selector-label">
                        Attachment Type
                      </div>
                      <div class="visual-selector-grid three-col">
                        <div class="visual-option selected" data-value="house_rim">
                          <div class="visual-option-icon">
                            <svg viewBox="0 0 36 36" fill="none" stroke="currentColor" stroke-width="2">
                              <!-- House wall -->
                              <rect x="2" y="4" width="8" height="28" fill="currentColor" opacity="0.15"/>
                              <line x1="10" y1="4" x2="10" y2="32"/>
                              <!-- Ledger attached -->
                              <rect x="10" y="14" width="22" height="4" fill="currentColor" opacity="0.3"/>
                              <!-- Deck frame -->
                              <line x1="10" y1="20" x2="32" y2="20"/>
                            </svg>
                          </div>
                          <div class="visual-option-name">Ledger</div>
                          <div class="visual-option-desc">House Rim</div>
                        </div>
                        <div class="visual-option" data-value="concrete">
                          <div class="visual-option-icon">
                            <svg viewBox="0 0 36 36" fill="none" stroke="currentColor" stroke-width="2">
                              <!-- Concrete foundation -->
                              <rect x="2" y="24" width="32" height="8" fill="currentColor" opacity="0.2"/>
                              <line x1="2" y1="24" x2="34" y2="24"/>
                              <!-- Bolts -->
                              <circle cx="10" cy="20" r="2" fill="currentColor"/>
                              <circle cx="26" cy="20" r="2" fill="currentColor"/>
                              <!-- Deck frame -->
                              <rect x="4" y="12" width="28" height="4"/>
                            </svg>
                          </div>
                          <div class="visual-option-name">Concrete</div>
                          <div class="visual-option-desc">Foundation</div>
                        </div>
                        <div class="visual-option" data-value="floating">
                          <div class="visual-option-icon">
                            <svg viewBox="0 0 36 36" fill="none" stroke="currentColor" stroke-width="2">
                              <!-- Freestanding deck -->
                              <rect x="4" y="10" width="28" height="4"/>
                              <!-- Posts -->
                              <rect x="6" y="14" width="4" height="14"/>
                              <rect x="26" y="14" width="4" height="14"/>
                              <!-- Footings -->
                              <ellipse cx="8" cy="30" rx="5" ry="2"/>
                              <ellipse cx="28" cy="30" rx="5" ry="2"/>
                            </svg>
                          </div>
                          <div class="visual-option-name">Floating</div>
                          <div class="visual-option-desc">Freestanding</div>
                        </div>
                      </div>
                      <select id="attachmentType" name="attachmentType" class="hidden-select" aria-label="Attachment type">
                        <option value="house_rim" selected>House Rim (Ledger)</option>
                        <option value="concrete">Concrete Foundation</option>
                        <option value="floating">Floating</option>
                      </select>
                    </div>
                    <!-- Beam Type Visual Selector -->
                    <div class="visual-selector compact" data-selector="beamType">
                      <div class="visual-selector-label">
                        Beam Type
                      </div>
                      <div class="visual-selector-grid two-col">
                        <div class="visual-option selected" data-value="drop">
                          <div class="visual-option-icon">
                            <svg viewBox="0 0 36 36" fill="none" stroke="currentColor" stroke-width="2">
                              <!-- Joists on top -->
                              <rect x="4" y="8" width="4" height="12"/>
                              <rect x="16" y="8" width="4" height="12"/>
                              <rect x="28" y="8" width="4" height="12"/>
                              <!-- Beam below -->
                              <rect x="2" y="22" width="32" height="6" fill="currentColor" opacity="0.3"/>
                              <!-- Post -->
                              <rect x="15" y="28" width="6" height="6"/>
                            </svg>
                          </div>
                          <div class="visual-option-name">Drop Beam</div>
                          <div class="visual-option-desc">Below joists</div>
                        </div>
                        <div class="visual-option" data-value="flush">
                          <div class="visual-option-icon">
                            <svg viewBox="0 0 36 36" fill="none" stroke="currentColor" stroke-width="2">
                              <!-- Beam flush with joists -->
                              <rect x="2" y="10" width="32" height="6" fill="currentColor" opacity="0.3"/>
                              <!-- Joists same level -->
                              <rect x="4" y="10" width="4" height="12"/>
                              <rect x="16" y="10" width="4" height="12"/>
                              <rect x="28" y="10" width="4" height="12"/>
                              <!-- Hangers -->
                              <path d="M8 10 L8 16 L12 16 L12 10" stroke-width="1"/>
                              <path d="M24 10 L24 16 L28 16 L28 10" stroke-width="1"/>
                              <!-- Post -->
                              <rect x="15" y="22" width="6" height="12"/>
                            </svg>
                          </div>
                          <div class="visual-option-name">Flush Beam</div>
                          <div class="visual-option-desc">Level with joists</div>
                        </div>
                      </div>
                      <select id="beamType" name="beamType" class="hidden-select" aria-label="Beam type">
                        <option value="drop" selected>Drop Beam</option>
                        <option value="flush">Flush Beam</option>
                      </select>
                    </div>
                    </div><!-- End Sub-step 2: Framing -->

                    <!-- Sub-step 3: Finishing -->
                    <div id="structure-substep-3" class="structure-substep" data-substep="3">
                    <!-- Picture Frame Visual Selector -->
                    <div class="visual-selector compact" data-selector="pictureFrame">
                      <div class="visual-selector-label">
                        Picture Frame
                      </div>
                      <div class="visual-selector-grid three-col">
                        <div class="visual-option selected" data-value="none">
                          <div class="visual-option-icon">
                            <svg viewBox="0 0 36 36" fill="none" stroke="currentColor" stroke-width="1.5">
                              <!-- Simple deck boards -->
                              <line x1="6" y1="8" x2="6" y2="28"/>
                              <line x1="12" y1="8" x2="12" y2="28"/>
                              <line x1="18" y1="8" x2="18" y2="28"/>
                              <line x1="24" y1="8" x2="24" y2="28"/>
                              <line x1="30" y1="8" x2="30" y2="28"/>
                              <rect x="4" y="6" width="28" height="24" stroke-dasharray="2 2"/>
                            </svg>
                          </div>
                          <div class="visual-option-name">None</div>
                        </div>
                        <div class="visual-option" data-value="single">
                          <div class="visual-option-icon">
                            <svg viewBox="0 0 36 36" fill="none" stroke="currentColor" stroke-width="1.5">
                              <!-- Deck boards -->
                              <line x1="10" y1="10" x2="10" y2="26"/>
                              <line x1="15" y1="10" x2="15" y2="26"/>
                              <line x1="20" y1="10" x2="20" y2="26"/>
                              <line x1="25" y1="10" x2="25" y2="26"/>
                              <!-- Single frame -->
                              <rect x="4" y="4" width="28" height="28" stroke-width="3" stroke="currentColor"/>
                            </svg>
                          </div>
                          <div class="visual-option-name">Single</div>
                        </div>
                        <div class="visual-option" data-value="double">
                          <div class="visual-option-icon">
                            <svg viewBox="0 0 36 36" fill="none" stroke="currentColor" stroke-width="1.5">
                              <!-- Deck boards -->
                              <line x1="12" y1="12" x2="12" y2="24"/>
                              <line x1="16" y1="12" x2="16" y2="24"/>
                              <line x1="20" y1="12" x2="20" y2="24"/>
                              <line x1="24" y1="12" x2="24" y2="24"/>
                              <!-- Double frame -->
                              <rect x="2" y="2" width="32" height="32" stroke-width="2"/>
                              <rect x="6" y="6" width="24" height="24" stroke-width="2"/>
                            </svg>
                          </div>
                          <div class="visual-option-name">Double</div>
                        </div>
                      </div>
                      <select id="pictureFrame" name="pictureFrame" class="hidden-select" aria-label="Picture frame border">
                        <option value="none" selected>None</option>
                        <option value="single">Single</option>
                        <option value="double">Double</option>
                      </select>
                    </div>
                    <!-- Joist Protection Visual Selector -->
                    <div class="visual-selector compact" data-selector="joistProtection">
                      <div class="visual-selector-label">
                        Joist Protection
                      </div>
                      <div class="visual-selector-grid three-col">
                        <div class="visual-option selected" data-value="none">
                          <div class="visual-option-icon">
                            <svg viewBox="0 0 36 36" fill="none" stroke="currentColor" stroke-width="2">
                              <!-- Plain joist -->
                              <rect x="6" y="12" width="24" height="12" rx="1"/>
                              <line x1="6" y1="18" x2="30" y2="18" stroke-dasharray="3 3" opacity="0.5"/>
                            </svg>
                          </div>
                          <div class="visual-option-name">None</div>
                          <div class="visual-option-desc">Unprotected</div>
                        </div>
                        <div class="visual-option" data-value="gtape">
                          <div class="visual-option-icon">
                            <svg viewBox="0 0 36 36" fill="none" stroke="currentColor" stroke-width="2">
                              <!-- Joist with tape on top -->
                              <rect x="6" y="14" width="24" height="12" rx="1"/>
                              <rect x="6" y="10" width="24" height="4" fill="currentColor" opacity="0.4" rx="1"/>
                              <line x1="10" y1="12" x2="14" y2="12" stroke-width="1" opacity="0.6"/>
                              <line x1="18" y1="12" x2="22" y2="12" stroke-width="1" opacity="0.6"/>
                              <line x1="26" y1="12" x2="30" y2="12" stroke-width="1" opacity="0.6"/>
                            </svg>
                          </div>
                          <div class="visual-option-name">G-Tape</div>
                          <div class="visual-option-desc">Flashing Tape</div>
                        </div>
                        <div class="visual-option" data-value="coating">
                          <div class="visual-option-icon">
                            <svg viewBox="0 0 36 36" fill="none" stroke="currentColor" stroke-width="2">
                              <!-- Joist with coating -->
                              <rect x="6" y="12" width="24" height="12" rx="1"/>
                              <path d="M6 12 Q18 8 30 12" fill="currentColor" opacity="0.3"/>
                              <path d="M8 14 L10 16 M14 13 L16 15 M20 14 L22 16 M26 13 L28 15" stroke-width="1" opacity="0.5"/>
                            </svg>
                          </div>
                          <div class="visual-option-name">Coating</div>
                          <div class="visual-option-desc">Liquid Applied</div>
                        </div>
                      </div>
                      <select id="joistProtection" name="joistProtection" class="hidden-select" aria-label="Joist protection">
                        <option value="none" selected>None</option>
                        <option value="gtape">G-Tape</option>
                        <option value="coating">Deck Coating</option>
                      </select>
                    </div>
                    <!-- Framing Fasteners Visual Selector -->
                    <div class="visual-selector compact" data-selector="fasteners">
                      <div class="visual-selector-label">
                        Framing Fasteners
                      </div>
                      <div class="visual-selector-grid three-col">
                        <div class="visual-option selected" data-value="screws_3in">
                          <div class="visual-option-icon">
                            <svg viewBox="0 0 36 36" fill="none" stroke="currentColor" stroke-width="2">
                              <!-- Screw -->
                              <circle cx="18" cy="8" r="4"/>
                              <line x1="16" y1="7" x2="20" y2="9"/>
                              <line x1="18" y1="12" x2="18" y2="30"/>
                              <path d="M16 16 L20 16 M16 20 L20 20 M16 24 L20 24 M16 28 L20 28" stroke-width="1"/>
                            </svg>
                          </div>
                          <div class="visual-option-name">Screws</div>
                          <div class="visual-option-desc">3" Deck</div>
                        </div>
                        <div class="visual-option" data-value="u2_3_18">
                          <div class="visual-option-icon">
                            <svg viewBox="0 0 36 36" fill="none" stroke="currentColor" stroke-width="2">
                              <!-- U2 structural screw -->
                              <ellipse cx="18" cy="7" rx="5" ry="3"/>
                              <line x1="18" y1="10" x2="18" y2="32"/>
                              <path d="M15 14 L21 14 M15 18 L21 18 M15 22 L21 22 M15 26 L21 26" stroke-width="1.5"/>
                              <path d="M17 30 L18 34 L19 30" fill="currentColor"/>
                            </svg>
                          </div>
                          <div class="visual-option-name">U2</div>
                          <div class="visual-option-desc">3-1/8" Structural</div>
                        </div>
                        <div class="visual-option" data-value="paslode_3_14">
                          <div class="visual-option-icon">
                            <svg viewBox="0 0 36 36" fill="none" stroke="currentColor" stroke-width="2">
                              <!-- Paslode nail -->
                              <circle cx="18" cy="6" r="3" fill="currentColor" opacity="0.3"/>
                              <rect x="16" y="9" width="4" height="23" rx="0.5"/>
                              <path d="M17 30 L18 34 L19 30" fill="currentColor"/>
                            </svg>
                          </div>
                          <div class="visual-option-name">Paslode</div>
                          <div class="visual-option-desc">3-1/4" Nails</div>
                        </div>
                      </div>
                      <select id="fasteners" name="fasteners" class="hidden-select" aria-label="Fastener type">
                        <option value="screws_3in" selected>3" Deck Screws</option>
                        <option value="u2_3_18">U2 3-1/8"</option>
                        <option value="paslode_3_14">Paslode 3-1/4"</option>
                      </select>
                    </div>
                    </div><!-- End Sub-step 3: Finishing -->

                  </form>
                </div>

                <!-- Sub-step Navigation buttons -->
                <div class="substep-actions">
                  <button type="button" class="btn btn-secondary substep-prev-btn" onclick="prevStructureSubstep()">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-4 h-4">
                      <path fill-rule="evenodd" d="M17 10a.75.75 0 01-.75.75H5.612l4.158 3.96a.75.75 0 11-1.04 1.08l-5.5-5.25a.75.75 0 010-1.08l5.5-5.25a.75.75 0 111.04 1.08L5.612 9.25H16.25A.75.75 0 0117 10z" clip-rule="evenodd" />
                    </svg>
                    <span>Back</span>
                  </button>
                  <button type="button" class="btn btn-primary substep-next-btn" onclick="nextStructureSubstep()">
                    <span>Next</span>
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-4 h-4">
                      <path fill-rule="evenodd" d="M3 10a.75.75 0 01.75-.75h10.638L10.23 5.29a.75.75 0 111.04-1.08l5.5 5.25a.75.75 0 010 1.08l-5.5 5.25a.75.75 0 11-1.04-1.08l4.158-3.96H3.75A.75.75 0 013 10z" clip-rule="evenodd" />
                    </svg>
                  </button>
                </div>

                <!-- Navigation buttons for Step 2 -->
                <div class="wizard-step-actions">
                  <button type="button" class="btn btn-secondary wizard-prev-btn" onclick="goToPreviousStep()">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-4 h-4">
                      <path fill-rule="evenodd" d="M17 10a.75.75 0 01-.75.75H5.612l4.158 3.96a.75.75 0 11-1.04 1.08l-5.5-5.25a.75.75 0 010-1.08l5.5-5.25a.75.75 0 111.04 1.08L5.612 9.25H16.25A.75.75 0 0117 10z" clip-rule="evenodd" />
                    </svg>
                    <span>Back</span>
                  </button>
                  <button type="button" class="btn btn-primary wizard-next-btn" onclick="goToNextStep()">
                    <span>Next: Stairs</span>
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-4 h-4">
                      <path fill-rule="evenodd" d="M3 10a.75.75 0 01.75-.75h10.638L10.23 5.29a.75.75 0 111.04-1.08l5.5 5.25a.75.75 0 010 1.08l-5.5 5.25a.75.75 0 11-1.04-1.08l4.158-3.96H3.75A.75.75 0 013 10z" clip-rule="evenodd" />
                    </svg>
                  </button>
                </div>
              </div>
            </div>

            <!-- Step 3: Stairs -->
            <div id="wizard-step-stairs" class="wizard-step-content hidden">
              <h2 class="wizard-step-title">Add Stairs</h2>
              <div class="panel-content">
                <div class="stair-specs">
                  <form id="stairSpecsForm" class="space-y-4">
                    <div>
                      <label for="stairWidth" class="form-label">Stair Width</label>
                      <select id="stairWidth" name="stairWidth" class="form-select">
                        <option value="4">4' 0"</option>
                        <option value="5">5' 0"</option>
                        <option value="6">6' 0"</option>
                        <option value="7">7' 0"</option>
                        <option value="8">8' 0"</option>
                        <option value="9">9' 0"</option>
                        <option value="10">10' 0"</option>
                        <option value="11">11' 0"</option>
                        <option value="12">12' 0"</option>
                        <option value="13">13' 0"</option>
                        <option value="14">14' 0"</option>
                        <option value="15">15' 0"</option>
                        <option value="16">16' 0"</option>
                        <option value="17">17' 0"</option>
                        <option value="18">18' 0"</option>
                        <option value="19">19' 0"</option>
                        <option value="20">20' 0"</option>
                      </select>
                    </div>
                    <!-- Stringer Type Visual Selector -->
                    <div class="visual-selector compact" data-selector="stringerType">
                      <div class="visual-selector-label">Stringer Type</div>
                      <div class="visual-selector-grid three-col">
                        <div class="visual-option selected" data-value="pylex_steel">
                          <div class="visual-option-icon">
                            <svg viewBox="0 0 36 36" fill="none" stroke="currentColor" stroke-width="2">
                              <path d="M8 28 L28 8"/>
                              <rect x="6" y="26" width="6" height="6" rx="1"/>
                              <rect x="24" y="4" width="6" height="6" rx="1"/>
                              <line x1="12" y1="22" x2="22" y2="12" stroke-dasharray="2 2"/>
                            </svg>
                          </div>
                          <div class="visual-option-name">Pylex Steel</div>
                          <div class="visual-option-desc">Pre-fab</div>
                        </div>
                        <div class="visual-option" data-value="lvl_wood">
                          <div class="visual-option-icon">
                            <svg viewBox="0 0 36 36" fill="none" stroke="currentColor" stroke-width="2">
                              <path d="M8 28 L28 8"/>
                              <rect x="6" y="26" width="6" height="6" rx="1"/>
                              <rect x="24" y="4" width="6" height="6" rx="1"/>
                              <path d="M10 24 L24 10" stroke-width="3"/>
                            </svg>
                          </div>
                          <div class="visual-option-name">LVL Wood</div>
                          <div class="visual-option-desc">Pre-fab</div>
                        </div>
                        <div class="visual-option" data-value="custom_2x12">
                          <div class="visual-option-icon">
                            <svg viewBox="0 0 36 36" fill="none" stroke="currentColor" stroke-width="2">
                              <path d="M8 28 L28 8"/>
                              <rect x="6" y="26" width="6" height="6" rx="1"/>
                              <rect x="24" y="4" width="6" height="6" rx="1"/>
                              <path d="M14 22 L14 18 M18 18 L18 14 M22 14 L22 10"/>
                            </svg>
                          </div>
                          <div class="visual-option-name">Custom 2x12</div>
                          <div class="visual-option-desc">Site Cut</div>
                        </div>
                      </div>
                      <select id="stringerType" name="stringerType" class="hidden-select" aria-label="Stringer type">
                        <option value="pylex_steel" selected>Pylex Steel (Pre-fab)</option>
                        <option value="lvl_wood">LVL Wood (Pre-fab)</option>
                        <option value="custom_2x12">Custom Cut 2x12</option>
                      </select>
                    </div>
                    <!-- Landing Type Visual Selector -->
                    <div class="visual-selector compact" data-selector="landingType">
                      <div class="visual-selector-label">Landing Type</div>
                      <div class="visual-selector-grid three-col">
                        <div class="visual-option selected" data-value="existing">
                          <div class="visual-option-icon">
                            <svg viewBox="0 0 36 36" fill="none" stroke="currentColor" stroke-width="2">
                              <rect x="4" y="24" width="28" height="8" rx="1"/>
                              <line x1="4" y1="28" x2="32" y2="28"/>
                              <path d="M8 24 L8 20 M16 24 L16 20 M24 24 L24 20"/>
                            </svg>
                          </div>
                          <div class="visual-option-name">Existing</div>
                          <div class="visual-option-desc">Ground/Patio</div>
                        </div>
                        <div class="visual-option" data-value="slabs_16x16">
                          <div class="visual-option-icon">
                            <svg viewBox="0 0 36 36" fill="none" stroke="currentColor" stroke-width="2">
                              <rect x="4" y="22" width="12" height="12" rx="1"/>
                              <rect x="20" y="22" width="12" height="12" rx="1"/>
                              <line x1="10" y1="22" x2="10" y2="34"/>
                              <line x1="26" y1="22" x2="26" y2="34"/>
                            </svg>
                          </div>
                          <div class="visual-option-name">16x16 Slabs</div>
                          <div class="visual-option-desc">Concrete Pads</div>
                        </div>
                        <div class="visual-option" data-value="concrete_pad">
                          <div class="visual-option-icon">
                            <svg viewBox="0 0 36 36" fill="none" stroke="currentColor" stroke-width="2">
                              <rect x="4" y="20" width="28" height="12" rx="1"/>
                              <line x1="4" y1="26" x2="32" y2="26"/>
                              <line x1="12" y1="20" x2="12" y2="32"/>
                              <line x1="24" y1="20" x2="24" y2="32"/>
                            </svg>
                          </div>
                          <div class="visual-option-name">Concrete Pad</div>
                          <div class="visual-option-desc">Poured</div>
                        </div>
                      </div>
                      <select id="landingType" name="landingType" class="hidden-select" aria-label="Landing type">
                        <option value="existing" selected>Existing Surface (Ground/Patio)</option>
                        <option value="slabs_16x16">16"x16" Slabs</option>
                        <option value="concrete_pad">Poured Concrete Pad</option>
                      </select>
                    </div>
                  </form>
                </div>

                <!-- Placed stairs list -->
                <div id="wizardStairList" class="stair-list-section">
                  <div class="flex justify-between items-center mb-2 mt-4">
                    <span class="text-sm font-medium text-gray-700">Placed Stairs</span>
                    <span id="wizardStairCount" class="text-sm text-gray-500">0 sets</span>
                  </div>
                  <div id="wizardStairListItems" class="stair-list space-y-2">
                    <!-- Dynamically populated -->
                  </div>
                </div>

                <!-- Navigation buttons for Step 3 -->
                <div class="wizard-step-actions">
                  <button type="button" class="btn btn-secondary wizard-prev-btn" onclick="goToPreviousStep()">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-4 h-4">
                      <path fill-rule="evenodd" d="M17 10a.75.75 0 01-.75.75H5.612l4.158 3.96a.75.75 0 11-1.04 1.08l-5.5-5.25a.75.75 0 010-1.08l5.5-5.25a.75.75 0 111.04 1.08L5.612 9.25H16.25A.75.75 0 0117 10z" clip-rule="evenodd" />
                    </svg>
                    <span>Back</span>
                  </button>
                  <button type="button" class="btn btn-primary wizard-next-btn" onclick="goToNextStep()">
                    <span>Next: Decking</span>
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-4 h-4">
                      <path fill-rule="evenodd" d="M3 10a.75.75 0 01.75-.75h10.638L10.23 5.29a.75.75 0 111.04-1.08l5.5 5.25a.75.75 0 010 1.08l-5.5 5.25a.75.75 0 11-1.04-1.08l4.158-3.96H3.75A.75.75 0 013 10z" clip-rule="evenodd" />
                    </svg>
                  </button>
                </div>
              </div>
            </div>

            <!-- Step 4: Decking (Coming Soon) -->
            <div id="wizard-step-decking" class="wizard-step-content hidden">
              <h2 class="wizard-step-title">Decking Materials</h2>
              <div class="panel-content">
                <p class="text-muted text-center py-8">Decking options coming soon</p>

                <!-- Navigation buttons for Step 4 -->
                <div class="wizard-step-actions">
                  <button type="button" class="btn btn-secondary wizard-prev-btn" onclick="goToPreviousStep()">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-4 h-4">
                      <path fill-rule="evenodd" d="M17 10a.75.75 0 01-.75.75H5.612l4.158 3.96a.75.75 0 11-1.04 1.08l-5.5-5.25a.75.75 0 010-1.08l5.5-5.25a.75.75 0 111.04 1.08L5.612 9.25H16.25A.75.75 0 0117 10z" clip-rule="evenodd" />
                    </svg>
                    <span>Back</span>
                  </button>
                  <button type="button" class="btn btn-primary wizard-next-btn" onclick="goToNextStep()">
                    <span>Next: Railing</span>
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-4 h-4">
                      <path fill-rule="evenodd" d="M3 10a.75.75 0 01.75-.75h10.638L10.23 5.29a.75.75 0 111.04-1.08l5.5 5.25a.75.75 0 010 1.08l-5.5 5.25a.75.75 0 11-1.04-1.08l4.158-3.96H3.75A.75.75 0 013 10z" clip-rule="evenodd" />
                    </svg>
                  </button>
                </div>
              </div>
            </div>

            <!-- Step 5: Railing (Coming Soon) -->
            <div id="wizard-step-railing" class="wizard-step-content hidden">
              <h2 class="wizard-step-title">Railing Options</h2>
              <div class="panel-content">
                <p class="text-muted text-center py-8">Railing options coming soon</p>

                <!-- Navigation buttons for Step 5 -->
                <div class="wizard-step-actions">
                  <button type="button" class="btn btn-secondary wizard-prev-btn" onclick="goToPreviousStep()">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-4 h-4">
                      <path fill-rule="evenodd" d="M17 10a.75.75 0 01-.75.75H5.612l4.158 3.96a.75.75 0 11-1.04 1.08l-5.5-5.25a.75.75 0 010-1.08l5.5-5.25a.75.75 0 111.04 1.08L5.612 9.25H16.25A.75.75 0 0117 10z" clip-rule="evenodd" />
                    </svg>
                    <span>Back</span>
                  </button>
                  <button type="button" class="btn btn-primary wizard-next-btn" onclick="goToNextStep()">
                    <span>Next: Review</span>
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-4 h-4">
                      <path fill-rule="evenodd" d="M3 10a.75.75 0 01.75-.75h10.638L10.23 5.29a.75.75 0 111.04-1.08l5.5 5.25a.75.75 0 010 1.08l-5.5 5.25a.75.75 0 11-1.04-1.08l4.158-3.96H3.75A.75.75 0 013 10z" clip-rule="evenodd" />
                    </svg>
                  </button>
                </div>
              </div>
            </div>

            <!-- Step 6: Review & Save -->
            <div id="wizard-step-review" class="wizard-step-content hidden">
              <h2 class="wizard-step-title">Review & Save</h2>
              <div class="panel-content">
                <!-- Quick Specs summary -->
                <div id="reviewSummarySection">
                  <h3 class="text-base font-semibold mb-2 text-[#333333]">
                    Specifications Summary
                  </h3>
                  <dl id="reviewSummaryList" class="summary-list text-sm"></dl>

                  <!-- View Full Specifications Button -->
                  <button type="button" id="reviewViewSpecsBtn" class="view-specs-btn" onclick="openSpecsModal()">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-4 h-4">
                      <path fill-rule="evenodd" d="M16.403 12.652a3 3 0 000-5.304 3 3 0 00-3.75-3.751 3 3 0 00-5.305 0 3 3 0 00-3.751 3.75 3 3 0 000 5.305 3 3 0 003.75 3.751 3 3 0 005.305 0 3 3 0 003.751-3.75zm-2.546-4.46a.75.75 0 00-1.214-.883l-3.483 4.79-1.88-1.88a.75.75 0 10-1.06 1.061l2.5 2.5a.75.75 0 001.137-.089l4-5.5z" clip-rule="evenodd" />
                    </svg>
                    View Full Specifications
                    <span class="permit-badge-small">Permit-Ready</span>
                  </button>
                </div>

                <!-- Stairs summary -->
                <div id="reviewStairsSection" class="mt-4">
                  <div class="flex justify-between items-center mb-2">
                    <h3 class="text-base font-semibold text-[#333333]">Stairs</h3>
                    <span id="reviewStairCount" class="text-sm text-gray-500">0 sets</span>
                  </div>
                  <div id="reviewStairList" class="stair-list space-y-1 text-sm">
                    <p class="text-gray-500">No stairs added</p>
                  </div>
                </div>

                <!-- Edit buttons to jump to steps -->
                <div class="review-edit-links mt-4">
                  <button type="button" class="review-edit-btn" onclick="setWizardStep('draw')">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-4 h-4">
                      <path d="M2.695 14.763l-1.262 3.154a.5.5 0 00.65.65l3.155-1.262a4 4 0 001.343-.885L17.5 5.5a2.121 2.121 0 00-3-3L3.58 13.42a4 4 0 00-.885 1.343z" />
                    </svg>
                    Edit Shape
                  </button>
                  <button type="button" class="review-edit-btn" onclick="setWizardStep('structure')">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-4 h-4">
                      <path d="M2.695 14.763l-1.262 3.154a.5.5 0 00.65.65l3.155-1.262a4 4 0 001.343-.885L17.5 5.5a2.121 2.121 0 00-3-3L3.58 13.42a4 4 0 00-.885 1.343z" />
                    </svg>
                    Edit Structure
                  </button>
                  <button type="button" class="review-edit-btn" onclick="setWizardStep('stairs')">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-4 h-4">
                      <path d="M2.695 14.763l-1.262 3.154a.5.5 0 00.65.65l3.155-1.262a4 4 0 001.343-.885L17.5 5.5a2.121 2.121 0 00-3-3L3.58 13.42a4 4 0 00-.885 1.343z" />
                    </svg>
                    Edit Stairs
                  </button>
                </div>

                <!-- Save/Export Actions -->
                <div class="review-actions mt-6">
                  <button type="button" class="btn btn-primary btn-full-width mb-2" onclick="openProjectsModal()">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-5 h-5 mr-2">
                      <path d="M2 4.75C2 3.784 2.784 3 3.75 3h4.836c.464 0 .909.184 1.237.513l1.414 1.414a.25.25 0 00.177.073h4.836c.966 0 1.75.784 1.75 1.75v8.5A1.75 1.75 0 0116.25 17H3.75A1.75 1.75 0 012 15.25V4.75z" />
                    </svg>
                    Save Project
                  </button>
                  <button type="button" class="btn btn-secondary btn-full-width" onclick="exportToPDF()">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-5 h-5 mr-2">
                      <path fill-rule="evenodd" d="M4.5 2A1.5 1.5 0 003 3.5v13A1.5 1.5 0 004.5 18h11a1.5 1.5 0 001.5-1.5V7.621a1.5 1.5 0 00-.44-1.06l-4.12-4.122A1.5 1.5 0 0011.378 2H4.5zm2.25 8.5a.75.75 0 000 1.5h6.5a.75.75 0 000-1.5h-6.5zm0 3a.75.75 0 000 1.5h6.5a.75.75 0 000-1.5h-6.5z" clip-rule="evenodd" />
                    </svg>
                    Export PDF
                  </button>
                </div>

                <!-- Navigation buttons for Step 6 -->
                <div class="wizard-step-actions">
                  <button type="button" class="btn btn-secondary wizard-prev-btn" onclick="goToPreviousStep()">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-4 h-4">
                      <path fill-rule="evenodd" d="M17 10a.75.75 0 01-.75.75H5.612l4.158 3.96a.75.75 0 11-1.04 1.08l-5.5-5.25a.75.75 0 010-1.08l5.5-5.25a.75.75 0 111.04 1.08L5.612 9.25H16.25A.75.75 0 0117 10z" clip-rule="evenodd" />
                    </svg>
                    <span>Back</span>
                  </button>
                </div>
              </div>
            </div>

            </div> <!-- End wizard-content -->
          </div> <!-- End wizard-panel -->
            </div> <!-- End input-panel -->

            <div id="main-content-panel" class="lg:w-3/4">
              <div class="info-card">
                <div
                  id="canvasContainerWrapper"
                  class="relative"
                >
                  <div id="dimensionInputContainer" class="flex items-center mb-2 hidden">
                    <label class="text-sm text-gray-600 mr-2">Enter length:</label>
                    <div class="flex flex-1 gap-2">
                      <input id="dimensionFeetInput" type="number" min="0" class="form-input text-sm py-1 px-2 w-16" placeholder="ft" aria-label="Length in feet">
                      <input id="dimensionInchesInput" type="number" min="0" max="11" class="form-input text-sm py-1 px-2 w-16" placeholder="in" aria-label="Length in inches">
                    </div>
                    <button id="applyDimensionBtn" class="btn btn-secondary text-xs px-3 py-1 leading-tight ml-2">Apply</button>
                    <button id="cancelDimensionBtn" class="btn btn-secondary text-xs px-3 py-1 leading-tight ml-2">Cancel</button>
                  </div>
                  <div id="canvasContainer" class="relative">
                    <canvas id="deckCanvas"></canvas>

                    <!-- Grid scale indicator -->
                    <div class="grid-scale-indicator">
                      <div class="scale-bar"></div>
                      <span class="scale-label">1 ft</span>
                    </div>

                    <!-- Floating control buttons (bottom center) -->
                    <div class="floating-controls">
                      <button
                        type="button"
                        id="undoBtn"
                        class="btn btn-secondary text-xs px-3 py-2 leading-tight shadow-lg btn-disabled"
                        title="Undo (Ctrl+Z)"
                        onclick="undo()"
                        disabled
                      >
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-5 h-5">
                          <path fill-rule="evenodd" d="M7.793 2.232a.75.75 0 01-.025 1.06L3.622 7.25h10.003a5.375 5.375 0 010 10.75H10.75a.75.75 0 010-1.5h2.875a3.875 3.875 0 000-7.75H3.622l4.146 3.957a.75.75 0 01-1.036 1.085l-5.5-5.25a.75.75 0 010-1.085l5.5-5.25a.75.75 0 011.06.025z" clip-rule="evenodd" />
                        </svg>
                      </button>
                      <button
                        type="button"
                        id="redoBtn"
                        class="btn btn-secondary text-xs px-3 py-2 leading-tight shadow-lg btn-disabled"
                        title="Redo (Ctrl+Y)"
                        onclick="redo()"
                        disabled
                      >
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-5 h-5">
                          <path fill-rule="evenodd" d="M12.207 2.232a.75.75 0 00.025 1.06l4.146 3.958H6.375a5.375 5.375 0 000 10.75H9.25a.75.75 0 000-1.5H6.375a3.875 3.875 0 010-7.75h10.003l-4.146 3.957a.75.75 0 001.036 1.085l5.5-5.25a.75.75 0 000-1.085l-5.5-5.25a.75.75 0 00-1.06.025z" clip-rule="evenodd" />
                        </svg>
                      </button>
                      <div class="floating-controls-divider"></div>
                      <button
                        type="button"
                        id="zoomInBtn"
                        class="btn btn-secondary text-xs px-3 py-2 leading-tight shadow-lg"
                        title="Zoom In"
                      >
                        <svg
                          xmlns="http://www.w3.org/2000/svg"
                          viewBox="0 0 20 20"
                          fill="currentColor"
                          class="w-5 h-5"
                        >
                          <path
                            d="M10.75 4.75a.75.75 0 0 0-1.5 0v4.5h-4.5a.75.75 0 0 0 0 1.5h4.5v4.5a.75.75 0 0 0 1.5 0v-4.5h4.5a.75.75 0 0 0 0-1.5h-4.5v-4.5Z"
                          />
                        </svg>
                      </button>
                      <button
                        type="button"
                        id="zoomOutBtn"
                        class="btn btn-secondary text-xs px-3 py-2 leading-tight shadow-lg"
                        title="Zoom Out"
                      >
                        <svg
                          xmlns="http://www.w3.org/2000/svg"
                          viewBox="0 0 20 20"
                          fill="currentColor"
                          class="w-5 h-5"
                        >
                          <path
                            fill-rule="evenodd"
                            d="M4 10a.75.75 0 0 1 .75-.75h10.5a.75.75 0 0 1 0 1.5H4.75A.75.75 0 0 1 4 10Z"
                            clip-rule="evenodd"
                          />
                        </svg>
                      </button>
                      <button
                        type="button"
                        id="centerFitBtn"
                        class="btn btn-secondary text-xs px-3 py-2 leading-tight shadow-lg"
                        title="Center & Fit"
                      >
                        <svg
                          xmlns="http://www.w3.org/2000/svg"
                          viewBox="0 0 24 24"
                          fill="none"
                          stroke="currentColor"
                          stroke-width="2"
                          stroke-linecap="round"
                          stroke-linejoin="round"
                          class="w-5 h-5"
                        >
                          <path d="M2 3h6v6H2z"/>
                          <path d="M16 3h6v6h-6z"/>
                          <path d="M16 15h6v6h-6z"/>
                          <path d="M2 15h6v6H2z"/>
                        </svg>
                      </button>
                      <button
                        id="blueprintToggleBtn"
                        class="btn btn-secondary text-xs px-3 py-2 leading-tight shadow-lg"
                        title="Blueprint View"
                      >
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-5 h-5">
                          <path d="M10 12.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z" />
                          <path fill-rule="evenodd" d="M.664 10.59a1.651 1.651 0 010-1.186A10.004 10.004 0 0110 3c4.257 0 7.893 2.66 9.336 6.41.147.381.146.804 0 1.186A10.004 10.004 0 0110 17c-4.257 0-7.893-2.66-9.336-6.41zM14 10a4 4 0 11-8 0 4 4 0 018 0z" clip-rule="evenodd" />
                        </svg>
                      </button>
                      <button
                        id="measureToolBtn"
                        class="btn btn-secondary text-xs px-3 py-2 leading-tight shadow-lg"
                        title="Measure Distance"
                      >
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-5 h-5">
                          <path fill-rule="evenodd" d="M2 4.25A2.25 2.25 0 014.25 2h11.5A2.25 2.25 0 0118 4.25v2a.75.75 0 01-1.5 0V5.56l-1.22 1.22v1.97a.75.75 0 01-1.5 0v-.72l-1.5 1.5v1.72a.75.75 0 01-1.5 0v-.47L9.28 11.28v1.97a.75.75 0 01-1.5 0v-.72l-1.5 1.5v1.72a.75.75 0 01-1.5 0v-.47L2 17.06v-2.81a.75.75 0 011.5 0v.25l1.22-1.22V11.5a.75.75 0 011.5 0v.72l1.5-1.5V8.75a.75.75 0 011.5 0v.97l1.5-1.5V6.25a.75.75 0 011.5 0v.72l1.5-1.5V4.25a.75.75 0 00-.75-.75H4.25a.75.75 0 00-.75.75v1.5a.75.75 0 01-1.5 0v-1.5z" clip-rule="evenodd" />
                        </svg>
                      </button>
                      <button
                        id="toggleDecompositionBtn"
                        class="btn btn-secondary text-xs px-3 py-2 leading-tight shadow-lg"
                        title="Show Sections"
                      >
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-5 h-5">
                          <path fill-rule="evenodd" d="M3 4.25A2.25 2.25 0 015.25 2h9.5A2.25 2.25 0 0117 4.25v2.5A2.25 2.25 0 0114.75 9h-9.5A2.25 2.25 0 013 6.75v-2.5zm2.25-.75a.75.75 0 00-.75.75v2.5c0 .414.336.75.75.75h9.5a.75.75 0 00.75-.75v-2.5a.75.75 0 00-.75-.75h-9.5z" clip-rule="evenodd" />
                          <path fill-rule="evenodd" d="M3 13.25A2.25 2.25 0 015.25 11h9.5A2.25 2.25 0 0117 13.25v2.5A2.25 2.25 0 0114.75 18h-9.5A2.25 2.25 0 013 15.75v-2.5zm2.25-.75a.75.75 0 00-.75.75v2.5c0 .414.336.75.75.75h9.5a.75.75 0 00.75-.75v-2.5a.75.75 0 00-.75-.75h-9.5z" clip-rule="evenodd" />
                        </svg>
                      </button>
                      <button
                        id="cutListModeBtn"
                        class="btn btn-secondary text-xs px-3 py-2 leading-tight shadow-lg"
                        title="Cut List Labels"
                        onclick="toggleCutListMode()"
                      >
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-5 h-5">
                          <path fill-rule="evenodd" d="M4.5 2A1.5 1.5 0 003 3.5v13A1.5 1.5 0 004.5 18h11a1.5 1.5 0 001.5-1.5V7.621a1.5 1.5 0 00-.44-1.06l-4.12-4.122A1.5 1.5 0 0011.378 2H4.5zm4.75 6.5a.75.75 0 00-1.5 0v2.25H5.5a.75.75 0 000 1.5h2.25v2.25a.75.75 0 001.5 0v-2.25h2.25a.75.75 0 000-1.5H9.25V8.5z" clip-rule="evenodd" />
                        </svg>
                      </button>
                      <button
                        id="preview3DBtn"
                        class="btn btn-secondary text-xs px-3 py-2 leading-tight shadow-lg"
                        title="3D Preview"
                        onclick="open3DPreview()"
                      >
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-5 h-5">
                          <path d="M10 3.5a1.5 1.5 0 013 0V4a1 1 0 001 1h3a1 1 0 011 1v3a1 1 0 01-1 1h-.5a1.5 1.5 0 000 3h.5a1 1 0 011 1v3a1 1 0 01-1 1h-3a1 1 0 01-1-1v-.5a1.5 1.5 0 00-3 0v.5a1 1 0 01-1 1H6a1 1 0 01-1-1v-3a1 1 0 00-1-1h-.5a1.5 1.5 0 010-3H4a1 1 0 001-1V6a1 1 0 011-1h3a1 1 0 001-1v-.5z" />
                        </svg>
                      </button>
                      <button
                        id="clearCanvasBtn"
                        class="btn btn-secondary text-xs px-3 py-2 leading-tight shadow-lg"
                        title="Clear Canvas"
                      >
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-5 h-5">
                          <path fill-rule="evenodd" d="M8.75 1A2.75 2.75 0 006 3.75v.443c-.795.077-1.584.176-2.365.298a.75.75 0 10.23 1.482l.149-.022.841 10.518A2.75 2.75 0 007.596 19h4.807a2.75 2.75 0 002.742-2.53l.841-10.52.149.023a.75.75 0 00.23-1.482A41.03 41.03 0 0014 4.193V3.75A2.75 2.75 0 0011.25 1h-2.5zM10 4c.84 0 1.673.025 2.5.075V3.75c0-.69-.56-1.25-1.25-1.25h-2.5c-.69 0-1.25.56-1.25 1.25v.325C8.327 4.025 9.16 4 10 4zM8.58 7.72a.75.75 0 00-1.5.06l.3 7.5a.75.75 0 101.5-.06l-.3-7.5zm4.34.06a.75.75 0 10-1.5-.06l-.3 7.5a.75.75 0 101.5.06l.3-7.5z" clip-rule="evenodd" />
                        </svg>
                      </button>
                      <div class="floating-controls-divider"></div>
                      <button
                        id="projectsBtn"
                        class="btn btn-secondary text-xs px-3 py-2 leading-tight shadow-lg"
                        title="Save/Load Projects"
                        onclick="openProjectsModal()"
                      >
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-5 h-5">
                          <path d="M2 4.75C2 3.784 2.784 3 3.75 3h4.836c.464 0 .909.184 1.237.513l1.414 1.414a.25.25 0 00.177.073h4.836c.966 0 1.75.784 1.75 1.75v8.5A1.75 1.75 0 0116.25 17H3.75A1.75 1.75 0 012 15.25V4.75z" />
                        </svg>
                      </button>
                      <button
                        id="exportPdfBtn"
                        class="btn btn-secondary text-xs px-3 py-2 leading-tight shadow-lg"
                        title="Export PDF"
                        onclick="exportToPDF()"
                      >
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-5 h-5">
                          <path fill-rule="evenodd" d="M4.5 2A1.5 1.5 0 003 3.5v13A1.5 1.5 0 004.5 18h11a1.5 1.5 0 001.5-1.5V7.621a1.5 1.5 0 00-.44-1.06l-4.12-4.122A1.5 1.5 0 0011.378 2H4.5zm2.25 8.5a.75.75 0 000 1.5h6.5a.75.75 0 000-1.5h-6.5zm0 3a.75.75 0 000 1.5h6.5a.75.75 0 000-1.5h-6.5z" clip-rule="evenodd" />
                        </svg>
                      </button>
                    </div>

                    <!-- Floating Legend -->
                    <div class="floating-legend" id="floatingLegend">
                      <button class="floating-legend-toggle" onclick="document.getElementById('floatingLegend').classList.toggle('expanded')" title="Toggle Legend">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-4 h-4">
                          <path fill-rule="evenodd" d="M2 4.75A.75.75 0 012.75 4h14.5a.75.75 0 010 1.5H2.75A.75.75 0 012 4.75zm0 10.5a.75.75 0 01.75-.75h7.5a.75.75 0 010 1.5h-7.5a.75.75 0 01-.75-.75zM2 10a.75.75 0 01.75-.75h14.5a.75.75 0 010 1.5H2.75A.75.75 0 012 10z" clip-rule="evenodd" />
                        </svg>
                        <span>Legend</span>
                      </button>
                      <div class="floating-legend-content">
                        <div class="legend-header">
                          <span>Show/Hide Layers</span>
                          <div class="legend-actions">
                            <button type="button" class="legend-action-btn" onclick="toggleAllLayers(true)" title="Show All">All</button>
                            <button type="button" class="legend-action-btn" onclick="toggleAllLayers(false)" title="Hide All">None</button>
                          </div>
                        </div>
                        <label class="legend-row legend-toggle">
                          <input type="checkbox" id="layer-outline" checked onchange="toggleLayerVisibility('outline')">
                          <span class="legend-color" style="background-color: #4A90E2;"></span>
                          <span class="legend-label">Outline</span>
                        </label>
                        <label class="legend-row legend-toggle">
                          <input type="checkbox" id="layer-dimensions" checked onchange="toggleLayerVisibility('dimensions')">
                          <span class="legend-color" style="background-color: #333333;"></span>
                          <span class="legend-label">Dimensions</span>
                        </label>
                        <label class="legend-row legend-toggle">
                          <input type="checkbox" id="layer-ledger" checked onchange="toggleLayerVisibility('ledger')">
                          <span class="legend-color" style="background-color: #f97316;"></span>
                          <span class="legend-label">Ledger</span>
                        </label>
                        <label class="legend-row legend-toggle">
                          <input type="checkbox" id="layer-joists" checked onchange="toggleLayerVisibility('joists')">
                          <span class="legend-color" style="background-color: #374151;"></span>
                          <span class="legend-label">Joists/Rim</span>
                        </label>
                        <label class="legend-row legend-toggle">
                          <input type="checkbox" id="layer-beams" checked onchange="toggleLayerVisibility('beams')">
                          <span class="legend-color" style="background-color: #dc2626;"></span>
                          <span class="legend-label">Beams</span>
                        </label>
                        <label class="legend-row legend-toggle">
                          <input type="checkbox" id="layer-posts" checked onchange="toggleLayerVisibility('posts')">
                          <span class="legend-color legend-color-post"></span>
                          <span class="legend-label">Posts/Footings</span>
                        </label>
                        <label class="legend-row legend-toggle">
                          <input type="checkbox" id="layer-blocking" checked onchange="toggleLayerVisibility('blocking')">
                          <span class="legend-color" style="background-color: #8B5CF6;"></span>
                          <span class="legend-label">Blocking</span>
                        </label>
                        <label class="legend-row legend-toggle">
                          <input type="checkbox" id="layer-stairs" checked onchange="toggleLayerVisibility('stairs')">
                          <span class="legend-color" style="background-color: #7c3aed;"></span>
                          <span class="legend-label">Stairs</span>
                        </label>
                      </div>
                    </div>
                  </div>
                </div>
              </div>

                <!-- BOM Placeholder (shown in Draw step) -->
                <div id="bomPlaceholder" class="info-card bom-placeholder">
                  <div class="bom-placeholder-content">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-12 h-12 mx-auto mb-3 opacity-40">
                      <path stroke-linecap="round" stroke-linejoin="round" d="M9 12h3.75M9 15h3.75M9 18h3.75m3 .75H18a2.25 2.25 0 002.25-2.25V6.108c0-1.135-.845-2.098-1.976-2.192a48.424 48.424 0 00-1.123-.08m-5.801 0c-.065.21-.1.433-.1.664 0 .414.336.75.75.75h4.5a.75.75 0 00.75-.75 2.25 2.25 0 00-.1-.664m-5.8 0A2.251 2.251 0 0113.5 2.25H15c1.012 0 1.867.668 2.15 1.586m-5.8 0c-.376.023-.75.05-1.124.08C9.095 4.01 8.25 4.973 8.25 6.108V8.25m0 0H4.875c-.621 0-1.125.504-1.125 1.125v11.25c0 .621.504 1.125 1.125 1.125h9.75c.621 0 1.125-.504 1.125-1.125V9.375c0-.621-.504-1.125-1.125-1.125H8.25zM6.75 12h.008v.008H6.75V12zm0 3h.008v.008H6.75V15zm0 3h.008v.008H6.75V18z" />
                    </svg>
                    <p class="text-gray-500 text-center">Complete the <strong>Structure</strong> step to see materials</p>
                  </div>
                </div>

                <div id="bomSection" class="info-card hidden">
                  <div class="flex justify-between items-center mb-4">
                    <h2 class="text-xl font-semibold text-[#333333]">
                      Materials List
                    </h2>
                  </div>
                  
                  
                  <div class="flex justify-between items-center mb-4">
                    <div></div>
                    <div class="flex gap-2">
                      <button
                        type="button"
                        id="resetAllBomBtn"
                        class="btn btn-secondary px-3 py-1 text-sm"
                        onclick="resetAllQuantities()"
                        title="Reset all quantities to calculated values"
                      >
                        <svg
                          xmlns="http://www.w3.org/2000/svg"
                          viewBox="0 0 20 20"
                          fill="currentColor"
                          class="w-4 h-4 inline-block mr-1 align-text-bottom"
                        >
                          <path fill-rule="evenodd" d="M15.312 11.424a5.5 5.5 0 01-9.201 2.466l-.312-.311h2.433a.75.75 0 000-1.5H3.989a.75.75 0 00-.75.75v4.242a.75.75 0 001.5 0v-2.43l.31.31a7 7 0 0011.712-3.138.75.75 0 00-1.449-.39zm1.23-3.723a.75.75 0 00.219-.53V2.929a.75.75 0 00-1.5 0V5.36l-.31-.31A7 7 0 003.239 8.188a.75.75 0 101.448.389A5.5 5.5 0 0113.89 6.11l.311.31h-2.432a.75.75 0 000 1.5h4.243a.75.75 0 00.53-.219z" clip-rule="evenodd" />
                        </svg>
                        Reset All
                      </button>
                      <button
                        type="button"
                        id="printBomBtn"
                        class="btn btn-secondary px-3 py-1 text-sm"
                      >
                        <svg
                          xmlns="http://www.w3.org/2000/svg"
                          viewBox="0 0 20 20"
                          fill="currentColor"
                          class="w-4 h-4 inline-block mr-1 align-text-bottom"
                        >
                          <path
                            fill-rule="evenodd"
                            d="M5 2.75C5 1.784 5.784 1 6.75 1h6.5c.966 0 1.75.784 1.75 1.75v3.552c.377.046.752.11 1.126.192.484.107.912.284 1.234.534a.75.75 0 0 1 0 1.244c-.322.25-.75.427-1.234.534a11.46 11.46 0 0 1-1.126.192v3.552c0 .966-.784 1.75-1.75 1.75h-6.5A1.75 1.75 0 0 1 5 14.25v-3.552a11.46 11.46 0 0 1-1.126-.192c-.484-.107-.912-.284-1.234-.534a.75.75 0 0 1 0-1.244c.322-.25.75-.427 1.234-.534A11.46 11.46 0 0 1 5 8.25V2.75Zm2.25 9.5a.75.75 0 0 0 .75.75h4a.75.75 0 0 0 .75-.75V8.75a.75.75 0 0 0-.75-.75h-4a.75.75 0 0 0-.75.75v3.5ZM5.28 3.22a.22.22 0 0 0-.221.28l.004.004a.753.753 0 0 0 .217.276V7.1a.75.75 0 0 0 .75.75h8.5a.75.75 0 0 0 .75-.75V3.78a.753.753 0 0 0 .217-.276l.004-.004a.22.22 0 0 0-.221-.28H5.28ZM3.5 7.875c0 .414.336.75.75.75h11.5a.75.75 0 0 0 .75-.75V4.125a.75.75 0 0 0-.75-.75H4.25a.75.75 0 0 0-.75.75v3.75Z"
                            clip-rule="evenodd"
                          />
                        </svg>
                        Print
                      </button>
                      <button
                        type="button"
                        id="addToCartBtn"
                        class="btn btn-primary px-3 py-1 text-sm hidden"
                        title="Add all materials to Shopify cart"
                      >
                        <svg
                          xmlns="http://www.w3.org/2000/svg"
                          viewBox="0 0 20 20"
                          fill="currentColor"
                          class="w-4 h-4 inline-block mr-1 align-text-bottom"
                        >
                          <path d="M1 1.75A.75.75 0 0 1 1.75 1h1.628a1.75 1.75 0 0 1 1.734 1.51L5.18 3a65.25 65.25 0 0 1 13.36 1.412.75.75 0 0 1 .58.875 48.645 48.645 0 0 1-1.618 6.2.75.75 0 0 1-.712.513H6a2.503 2.503 0 0 0-2.292 1.5H17.25a.75.75 0 0 1 0 1.5H2.76a.75.75 0 0 1-.748-.807 4.002 4.002 0 0 1 2.716-3.486L3.626 2.716a.25.25 0 0 0-.248-.216H1.75A.75.75 0 0 1 1 1.75ZM6 17.5a1.5 1.5 0 1 1-3 0 1.5 1.5 0 0 1 3 0ZM15.5 19a1.5 1.5 0 1 0 0-3 1.5 1.5 0 0 0 0 3Z" />
                        </svg>
                        Add to Cart
                      </button>
                    </div>
                  </div>
                  <div class="overflow-x-auto">
                    <table class="w-full bom-table">
                      <thead>
                        <tr>
                          <th class="qty-col">Qty</th>
                          <th>Item</th>
                          <th>Description</th>
                          <th class="price-col">Unit Price</th>
                          <th class="price-col">Total Price</th>
                        </tr>
                      </thead>
                      <tbody id="bomTableBody"></tbody>
                    </table>
                  </div>
                </div>
              </div>

            </div>
          </div>
        </div>

        <!-- Decking Tab Content -->
        <div
          id="decking-content"
          class="tab-content"
          role="tabpanel"
          aria-labelledby="decking-tab"
        >
          <div id="decking-layout-container" class="flex flex-col lg:flex-row gap-8">
            <p class="text-muted text-center py-8 w-full">Decking calculator coming soon</p>
          </div>
        </div>

        <!-- Railing Tab Content -->
        <div
          id="railing-content"
          class="tab-content"
          role="tabpanel"
          aria-labelledby="railing-tab"
        >
          <div id="railing-layout-container" class="flex flex-col lg:flex-row gap-8">
            <p class="text-muted text-center py-8 w-full">Railing calculator coming soon</p>
          </div>
        </div>

        <!-- Enhanced Summary Tab Content -->
        <div
          id="summary-content"
          class="tab-content"
          role="tabpanel"
          aria-labelledby="summary-tab"
        >
          <div id="summary-layout-container" class="flex flex-col lg:flex-row gap-8">
            <p class="text-muted text-center py-8 w-full">Enhanced summary coming soon</p>
          </div>
        </div>
      </div>
    </div>

    <!-- Structural Specifications Modal -->
    <div id="specsModal" class="specs-modal hidden" onclick="if(event.target === this) closeSpecsModal()">
      <div class="specs-modal-content">
        <div class="specs-modal-header">
          <div class="specs-modal-title">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-6 h-6 text-[var(--tuds-green-dark)]">
              <path fill-rule="evenodd" d="M16.403 12.652a3 3 0 000-5.304 3 3 0 00-3.75-3.751 3 3 0 00-5.305 0 3 3 0 00-3.751 3.75 3 3 0 000 5.305 3 3 0 003.75 3.751 3 3 0 005.305 0 3 3 0 003.751-3.75zm-2.546-4.46a.75.75 0 00-1.214-.883l-3.483 4.79-1.88-1.88a.75.75 0 10-1.06 1.061l2.5 2.5a.75.75 0 001.137-.089l4-5.5z" clip-rule="evenodd" />
            </svg>
            <h2>Structural Specifications</h2>
            <span class="permit-badge">Permit-Ready</span>
          </div>
          <button type="button" class="specs-modal-close" onclick="closeSpecsModal()" title="Close">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-5 h-5">
              <path d="M6.28 5.22a.75.75 0 00-1.06 1.06L8.94 10l-3.72 3.72a.75.75 0 101.06 1.06L10 11.06l3.72 3.72a.75.75 0 101.06-1.06L11.06 10l3.72-3.72a.75.75 0 00-1.06-1.06L10 8.94 6.28 5.22z" />
            </svg>
          </button>
        </div>

        <p class="structural-specs-intro">
          Reference specifications for building permit applications. Verify all requirements with your local building authority.
        </p>

        <div class="specs-modal-body">
          <div class="structural-specs-grid">
            <!-- Design Loads -->
            <div class="spec-card">
              <div class="spec-card-header">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="spec-icon">
                  <path d="M10.75 10.818v2.614A3.13 3.13 0 0011.888 13c.482-.315.612-.648.612-.875 0-.227-.13-.56-.612-.875a3.13 3.13 0 00-1.138-.432zM8.33 8.62c.053.055.115.11.184.164.208.16.46.284.736.363V6.603a2.45 2.45 0 00-.35.13c-.14.065-.27.143-.386.233-.377.292-.514.627-.514.909 0 .184.058.39.202.592.037.051.08.102.128.152z" />
                  <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-8-6a.75.75 0 01.75.75v.316a3.78 3.78 0 011.653.713c.426.33.744.74.925 1.2a.75.75 0 01-1.395.55 1.35 1.35 0 00-.447-.563 2.187 2.187 0 00-.736-.363V9.3c.698.093 1.383.32 1.959.696.787.514 1.29 1.27 1.29 2.13 0 .86-.504 1.616-1.29 2.13-.576.377-1.261.603-1.96.696v.299a.75.75 0 11-1.5 0v-.3c-.697-.092-1.382-.318-1.958-.695-.482-.315-.857-.717-1.078-1.188a.75.75 0 111.359-.636c.08.173.245.376.54.569.313.205.706.353 1.137.432v-2.748a3.782 3.782 0 01-1.653-.713C6.9 9.433 6.5 8.681 6.5 7.875c0-.805.4-1.558 1.088-2.066.27-.199.576-.356.912-.47V5.045a.75.75 0 01.75-.75c.41 0 .75.336.75.75z" clip-rule="evenodd" />
                </svg>
                <h3>Design Loads</h3>
              </div>
              <div class="spec-card-content">
                <div class="spec-row">
                  <span class="spec-label">Live Load (People/Furniture)</span>
                  <span class="spec-value" id="specLiveLoad">40 PSF</span>
                </div>
                <div class="spec-row">
                  <span class="spec-label">Dead Load (Structure)</span>
                  <span class="spec-value" id="specDeadLoad">10 PSF</span>
                </div>
                <div class="spec-row highlight">
                  <span class="spec-label">Total Design Load</span>
                  <span class="spec-value" id="specTotalLoad">50 PSF</span>
                </div>
                <div class="spec-note">
                  Based on IRC R507.1 residential deck requirements
                </div>
              </div>
            </div>

            <!-- Joist Specifications -->
            <div class="spec-card">
              <div class="spec-card-header">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="spec-icon">
                  <path d="M3.75 3a.75.75 0 00-.75.75v12.5c0 .414.336.75.75.75h12.5a.75.75 0 00.75-.75V3.75a.75.75 0 00-.75-.75H3.75zM5.5 5.5h9v9h-9v-9z" />
                </svg>
                <h3>Joist System</h3>
              </div>
              <div class="spec-card-content">
                <div class="spec-row">
                  <span class="spec-label">Joist Size</span>
                  <span class="spec-value" id="specJoistSize">--</span>
                </div>
                <div class="spec-row">
                  <span class="spec-label">Spacing (O.C.)</span>
                  <span class="spec-value" id="specJoistSpacing">--</span>
                </div>
                <div class="spec-row">
                  <span class="spec-label">Actual Span</span>
                  <span class="spec-value" id="specJoistActualSpan">--</span>
                </div>
                <div class="spec-row compliance">
                  <span class="spec-label">Max Allowable Span</span>
                  <span class="spec-value" id="specJoistMaxSpan">--</span>
                </div>
                <div class="spec-compliance-status" id="joistComplianceStatus">
                  <span class="compliance-icon"></span>
                  <span class="compliance-text">Calculating...</span>
                </div>
              </div>
            </div>

            <!-- Beam Specifications -->
            <div class="spec-card">
              <div class="spec-card-header">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="spec-icon">
                  <path fill-rule="evenodd" d="M4.25 2A2.25 2.25 0 002 4.25v11.5A2.25 2.25 0 004.25 18h11.5A2.25 2.25 0 0018 15.75V4.25A2.25 2.25 0 0015.75 2H4.25zM15 5.75a.75.75 0 00-1.5 0v8.5a.75.75 0 001.5 0v-8.5zm-8.5 6a.75.75 0 00-1.5 0v2.5a.75.75 0 001.5 0v-2.5zM8.584 9a.75.75 0 01.75.75v4.5a.75.75 0 01-1.5 0v-4.5a.75.75 0 01.75-.75zm3.58-1.25a.75.75 0 00-1.5 0v6.5a.75.75 0 001.5 0v-6.5z" clip-rule="evenodd" />
                </svg>
                <h3>Beam System</h3>
              </div>
              <div class="spec-card-content">
                <div class="spec-row">
                  <span class="spec-label">Beam Configuration</span>
                  <span class="spec-value" id="specBeamConfig">--</span>
                </div>
                <div class="spec-row">
                  <span class="spec-label">Beam Type</span>
                  <span class="spec-value" id="specBeamType">--</span>
                </div>
                <div class="spec-row">
                  <span class="spec-label">Total Beam Length</span>
                  <span class="spec-value" id="specBeamLength">--</span>
                </div>
                <div class="spec-row">
                  <span class="spec-label">Number of Beams</span>
                  <span class="spec-value" id="specBeamCount">--</span>
                </div>
              </div>
            </div>

            <!-- Post & Foundation -->
            <div class="spec-card">
              <div class="spec-card-header">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="spec-icon">
                  <path fill-rule="evenodd" d="M9.674 2.075a.75.75 0 01.652 0l7.25 3.5A.75.75 0 0117 6.957V16.5h.25a.75.75 0 010 1.5H2.75a.75.75 0 010-1.5H3V6.957a.75.75 0 01-.576-1.382l7.25-3.5zM11 6a1 1 0 11-2 0 1 1 0 012 0zM7.5 9.75a.75.75 0 00-1.5 0v5.5a.75.75 0 001.5 0v-5.5zm3.25-.75a.75.75 0 01.75.75v5.5a.75.75 0 01-1.5 0v-5.5a.75.75 0 01.75-.75zm3.25.75a.75.75 0 00-1.5 0v5.5a.75.75 0 001.5 0v-5.5z" clip-rule="evenodd" />
                </svg>
                <h3>Posts & Foundations</h3>
              </div>
              <div class="spec-card-content">
                <div class="spec-row">
                  <span class="spec-label">Post Size</span>
                  <span class="spec-value" id="specPostSize">--</span>
                </div>
                <div class="spec-row">
                  <span class="spec-label">Post Height</span>
                  <span class="spec-value" id="specPostHeight">--</span>
                </div>
                <div class="spec-row">
                  <span class="spec-label">Number of Posts</span>
                  <span class="spec-value" id="specPostCount">--</span>
                </div>
                <div class="spec-row">
                  <span class="spec-label">Max Post Spacing</span>
                  <span class="spec-value" id="specPostSpacing">8' O.C.</span>
                </div>
                <div class="spec-row">
                  <span class="spec-label">Footing Type</span>
                  <span class="spec-value" id="specFootingType">--</span>
                </div>
                <div class="spec-row">
                  <span class="spec-label">Number of Footings</span>
                  <span class="spec-value" id="specFootingCount">--</span>
                </div>
              </div>
            </div>

            <!-- Ledger Attachment -->
            <div class="spec-card">
              <div class="spec-card-header">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="spec-icon">
                  <path d="M10 1a6 6 0 00-3.815 10.631C7.237 12.5 8 13.443 8 14.456v.644a.75.75 0 00.572.729 6.016 6.016 0 002.856 0A.75.75 0 0012 15.1v-.644c0-1.013.762-1.957 1.815-2.825A6 6 0 0010 1zM8.863 17.414a.75.75 0 00-.226 1.483 9.066 9.066 0 002.726 0 .75.75 0 00-.226-1.483 7.553 7.553 0 01-2.274 0z" />
                </svg>
                <h3>Attachment Method</h3>
              </div>
              <div class="spec-card-content">
                <div class="spec-row">
                  <span class="spec-label">Attachment Type</span>
                  <span class="spec-value" id="specAttachmentType">--</span>
                </div>
                <div class="spec-row">
                  <span class="spec-label">Ledger Size</span>
                  <span class="spec-value" id="specLedgerSize">--</span>
                </div>
                <div class="spec-row">
                  <span class="spec-label">Ledger Length</span>
                  <span class="spec-value" id="specLedgerLength">--</span>
                </div>
                <div class="spec-note" id="specLedgerNote">
                  Ledger attachment per IRC R507.9.1
                </div>
              </div>
            </div>

            <!-- Code References -->
            <div class="spec-card code-references">
              <div class="spec-card-header">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="spec-icon">
                  <path fill-rule="evenodd" d="M4.5 2A1.5 1.5 0 003 3.5v13A1.5 1.5 0 004.5 18h11a1.5 1.5 0 001.5-1.5V7.621a1.5 1.5 0 00-.44-1.06l-4.12-4.122A1.5 1.5 0 0011.378 2H4.5zm2.25 8.5a.75.75 0 000 1.5h6.5a.75.75 0 000-1.5h-6.5zm0 3a.75.75 0 000 1.5h6.5a.75.75 0 000-1.5h-6.5z" clip-rule="evenodd" />
                </svg>
                <h3>Code References</h3>
              </div>
              <div class="spec-card-content">
                <ul class="code-reference-list">
                  <li><strong>IRC R507</strong> - Exterior Decks</li>
                  <li><strong>IRC R507.5</strong> - Deck Joists</li>
                  <li><strong>IRC R507.6</strong> - Deck Beams</li>
                  <li><strong>IRC R507.8</strong> - Deck Posts</li>
                  <li><strong>IRC R507.9</strong> - Deck Ledger Board</li>
                </ul>
                <div class="spec-disclaimer">
                  Always verify specifications with your local building department. Code requirements vary by jurisdiction.
                </div>
              </div>
            </div>
          </div>
        </div>

        <div class="specs-modal-footer">
          <button type="button" id="printSpecsBtn" class="btn btn-secondary px-4 py-2 text-sm" onclick="window.print()">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-4 h-4 inline-block mr-1.5 align-text-bottom">
              <path fill-rule="evenodd" d="M5 2.75C5 1.784 5.784 1 6.75 1h6.5c.966 0 1.75.784 1.75 1.75v3.552c.377.046.752.11 1.126.192.484.107.912.284 1.234.534a.75.75 0 010 1.244c-.322.25-.75.427-1.234.534a11.46 11.46 0 01-1.126.192v3.552c0 .966-.784 1.75-1.75 1.75h-6.5A1.75 1.75 0 015 14.25v-3.552a11.46 11.46 0 01-1.126-.192c-.484-.107-.912-.284-1.234-.534a.75.75 0 010-1.244c.322-.25.75-.427 1.234-.534A11.46 11.46 0 015 8.25V2.75z" clip-rule="evenodd" />
            </svg>
            Print Specifications
          </button>
          <button type="button" class="btn btn-primary px-4 py-2 text-sm" onclick="closeSpecsModal()">
            Close
          </button>
        </div>
      </div>
    </div>

    <!-- Cut List Modal -->
    <div id="cutListModal" class="cut-list-modal hidden" onclick="if(event.target === this) closeCutListModal()">
      <div class="cut-list-modal-content">
        <div class="cut-list-modal-header">
          <div class="cut-list-modal-title">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-6 h-6 text-[var(--tuds-green-dark)]">
              <path fill-rule="evenodd" d="M4.5 2A1.5 1.5 0 003 3.5v13A1.5 1.5 0 004.5 18h11a1.5 1.5 0 001.5-1.5V7.621a1.5 1.5 0 00-.44-1.06l-4.12-4.122A1.5 1.5 0 0011.378 2H4.5zM6 7a.75.75 0 000 1.5h8A.75.75 0 0014 7H6zm0 3.5a.75.75 0 000 1.5h8a.75.75 0 000-1.5H6zm0 3.5a.75.75 0 000 1.5h5a.75.75 0 000-1.5H6z" clip-rule="evenodd" />
            </svg>
            <h2>Framing Cut List</h2>
            <span class="cut-list-badge">For Construction</span>
          </div>
          <button type="button" class="cut-list-modal-close" onclick="closeCutListModal()" title="Close">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-5 h-5">
              <path d="M6.28 5.22a.75.75 0 00-1.06 1.06L8.94 10l-3.72 3.72a.75.75 0 101.06 1.06L10 11.06l3.72 3.72a.75.75 0 101.06-1.06L11.06 10l3.72-3.72a.75.75 0 00-1.06-1.06L10 8.94 6.28 5.22z" />
            </svg>
          </button>
        </div>

        <p class="cut-list-intro">
          Detailed lumber cut list with component labels matching the diagram. Print for easy reference during construction.
        </p>

        <div class="cut-list-modal-body">
          <!-- Summary Stats -->
          <div class="cut-list-summary">
            <div class="cut-list-stat">
              <span class="stat-value" id="cutListTotalPieces">0</span>
              <span class="stat-label">Total Pieces</span>
            </div>
            <div class="cut-list-stat">
              <span class="stat-value" id="cutListTotalLF">0</span>
              <span class="stat-label">Linear Feet</span>
            </div>
            <div class="cut-list-stat">
              <span class="stat-value" id="cutListUniqueTypes">0</span>
              <span class="stat-label">Unique Sizes</span>
            </div>
          </div>

          <!-- Cut List Table -->
          <div class="cut-list-table-container">
            <table class="cut-list-table">
              <thead>
                <tr>
                  <th class="label-col">Label</th>
                  <th class="type-col">Component</th>
                  <th class="size-col">Size</th>
                  <th class="length-col">Length</th>
                  <th class="qty-col">Qty</th>
                </tr>
              </thead>
              <tbody id="cutListTableBody">
                <!-- Cut list items will be populated here -->
              </tbody>
            </table>
          </div>

          <!-- Grouped by size summary -->
          <div class="cut-list-grouped">
            <h3>Summary by Size</h3>
            <div id="cutListGroupedContent">
              <!-- Grouped summary will be populated here -->
            </div>
          </div>
        </div>

        <div class="cut-list-modal-footer">
          <button type="button" id="printCutListBtn" class="btn btn-secondary px-4 py-2 text-sm" onclick="printCutList()">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-4 h-4 inline-block mr-1.5 align-text-bottom">
              <path fill-rule="evenodd" d="M5 2.75C5 1.784 5.784 1 6.75 1h6.5c.966 0 1.75.784 1.75 1.75v3.552c.377.046.752.11 1.126.192.484.107.912.284 1.234.534a.75.75 0 010 1.244c-.322.25-.75.427-1.234.534a11.46 11.46 0 01-1.126.192v3.552c0 .966-.784 1.75-1.75 1.75h-6.5A1.75 1.75 0 015 14.25v-3.552a11.46 11.46 0 01-1.126-.192c-.484-.107-.912-.284-1.234-.534a.75.75 0 010-1.244c.322-.25.75-.427 1.234-.534A11.46 11.46 0 015 8.25V2.75z" clip-rule="evenodd" />
            </svg>
            Print Cut List
          </button>
          <button type="button" class="btn btn-primary px-4 py-2 text-sm" onclick="closeCutListModal()">
            Close
          </button>
        </div>
      </div>
    </div>

    <!-- 3D Preview Modal -->
    <div id="preview3DModal" class="preview3d-modal hidden" onclick="if(event.target === this) close3DPreview()">
      <div class="preview3d-modal-content">
        <div class="preview3d-modal-header">
          <div class="preview3d-modal-title">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-6 h-6 text-[var(--tuds-green-dark)]">
              <path d="M10 3.5a1.5 1.5 0 013 0V4a1 1 0 001 1h3a1 1 0 011 1v3a1 1 0 01-1 1h-.5a1.5 1.5 0 000 3h.5a1 1 0 011 1v3a1 1 0 01-1 1h-3a1 1 0 01-1-1v-.5a1.5 1.5 0 00-3 0v.5a1 1 0 01-1 1H6a1 1 0 01-1-1v-3a1 1 0 00-1-1h-.5a1.5 1.5 0 010-3H4a1 1 0 001-1V6a1 1 0 011-1h3a1 1 0 001-1v-.5z" />
            </svg>
            <h2>3D Preview</h2>
            <span class="preview3d-badge">Isometric View</span>
          </div>
          <button type="button" class="preview3d-modal-close" onclick="close3DPreview()" title="Close">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-5 h-5">
              <path d="M6.28 5.22a.75.75 0 00-1.06 1.06L8.94 10l-3.72 3.72a.75.75 0 101.06 1.06L10 11.06l3.72 3.72a.75.75 0 101.06-1.06L11.06 10l3.72-3.72a.75.75 0 00-1.06-1.06L10 8.94 6.28 5.22z" />
            </svg>
          </button>
        </div>

        <div class="preview3d-controls">
          <div class="preview3d-control-group">
            <label>View Angle</label>
            <div class="preview3d-angle-btns">
              <button type="button" class="angle-btn active" data-angle="front-right" onclick="set3DAngle('front-right')">Front-Right</button>
              <button type="button" class="angle-btn" data-angle="front-left" onclick="set3DAngle('front-left')">Front-Left</button>
              <button type="button" class="angle-btn" data-angle="back-right" onclick="set3DAngle('back-right')">Back-Right</button>
              <button type="button" class="angle-btn" data-angle="back-left" onclick="set3DAngle('back-left')">Back-Left</button>
            </div>
          </div>
          <div class="preview3d-control-group">
            <label>Show Layers</label>
            <div class="preview3d-layer-toggles">
              <label class="layer-toggle"><input type="checkbox" id="show3d-decking" checked onchange="update3DPreview()"><span>Decking</span></label>
              <label class="layer-toggle"><input type="checkbox" id="show3d-joists" checked onchange="update3DPreview()"><span>Joists</span></label>
              <label class="layer-toggle"><input type="checkbox" id="show3d-beams" checked onchange="update3DPreview()"><span>Beams</span></label>
              <label class="layer-toggle"><input type="checkbox" id="show3d-posts" checked onchange="update3DPreview()"><span>Posts</span></label>
            </div>
          </div>
        </div>

        <div class="preview3d-modal-body">
          <canvas id="preview3DCanvas" width="800" height="600"></canvas>
          <div class="preview3d-info">
            <span id="preview3dDimensions">-</span>
          </div>
        </div>

        <div class="preview3d-modal-footer">
          <button type="button" class="btn btn-secondary px-4 py-2 text-sm" onclick="download3DPreview()">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-4 h-4 inline-block mr-1.5 align-text-bottom">
              <path d="M10.75 2.75a.75.75 0 00-1.5 0v8.614L6.295 8.235a.75.75 0 10-1.09 1.03l4.25 4.5a.75.75 0 001.09 0l4.25-4.5a.75.75 0 00-1.09-1.03l-2.955 3.129V2.75z" />
              <path d="M3.5 12.75a.75.75 0 00-1.5 0v2.5A2.75 2.75 0 004.75 18h10.5A2.75 2.75 0 0018 15.25v-2.5a.75.75 0 00-1.5 0v2.5c0 .69-.56 1.25-1.25 1.25H4.75c-.69 0-1.25-.56-1.25-1.25v-2.5z" />
            </svg>
            Download Image
          </button>
          <button type="button" class="btn btn-primary px-4 py-2 text-sm" onclick="close3DPreview()">
            Close
          </button>
        </div>
      </div>
    </div>

    <!-- Help Wizard Overlay -->
    <div id="helpWizardOverlay" class="help-wizard-overlay hidden">
      <!-- Spotlight highlight element -->
      <div id="wizardSpotlight" class="wizard-spotlight"></div>

      <!-- Tooltip container -->
      <div id="wizardTooltip" class="wizard-tooltip">
        <div class="wizard-tooltip-header">
          <span class="wizard-step-indicator" id="wizardStepIndicator">Step 1 of 8</span>
          <button type="button" class="wizard-close-btn" onclick="endHelpWizard()" title="Close tutorial">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-5 h-5">
              <path d="M6.28 5.22a.75.75 0 00-1.06 1.06L8.94 10l-3.72 3.72a.75.75 0 101.06 1.06L10 11.06l3.72 3.72a.75.75 0 101.06-1.06L11.06 10l3.72-3.72a.75.75 0 00-1.06-1.06L10 8.94 6.28 5.22z" />
            </svg>
          </button>
        </div>
        <div class="wizard-tooltip-content">
          <h3 id="wizardTitle" class="wizard-title">Welcome to TUDS Pro Deck Estimator</h3>
          <p id="wizardDescription" class="wizard-description">Let's take a quick tour of the main features to help you get started.</p>
        </div>
        <div class="wizard-tooltip-footer">
          <button type="button" id="wizardPrevBtn" class="btn btn-secondary wizard-btn" onclick="prevWizardStep()">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-4 h-4">
              <path fill-rule="evenodd" d="M12.79 5.23a.75.75 0 01-.02 1.06L8.832 10l3.938 3.71a.75.75 0 11-1.04 1.08l-4.5-4.25a.75.75 0 010-1.08l4.5-4.25a.75.75 0 011.06.02z" clip-rule="evenodd" />
            </svg>
            Back
          </button>
          <div class="wizard-progress">
            <div id="wizardProgressDots" class="wizard-progress-dots"></div>
          </div>
          <button type="button" id="wizardNextBtn" class="btn btn-primary wizard-btn" onclick="nextWizardStep()">
            Next
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-4 h-4">
              <path fill-rule="evenodd" d="M7.21 14.77a.75.75 0 01.02-1.06L11.168 10 7.23 6.29a.75.75 0 111.04-1.08l4.5 4.25a.75.75 0 010 1.08l-4.5 4.25a.75.75 0 01-1.06-.02z" clip-rule="evenodd" />
            </svg>
          </button>
        </div>
        <div class="wizard-skip-link">
          <button type="button" class="wizard-skip-btn" onclick="endHelpWizard()">Skip tutorial</button>
        </div>
      </div>
    </div>

    <!-- Projects Modal -->
    <div id="projectsModal" class="projects-modal hidden" onclick="if(event.target === this) closeProjectsModal()">
      <div class="projects-modal-content">
        <div class="projects-modal-header">
          <div class="projects-modal-title">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-6 h-6">
              <path d="M2 4.75C2 3.784 2.784 3 3.75 3h4.836c.464 0 .909.184 1.237.513l1.414 1.414a.25.25 0 00.177.073h4.836c.966 0 1.75.784 1.75 1.75v8.5A1.75 1.75 0 0116.25 17H3.75A1.75 1.75 0 012 15.25V4.75z" />
            </svg>
            <h2>My Projects</h2>
          </div>
          <button type="button" class="projects-modal-close" onclick="closeProjectsModal()" title="Close">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-5 h-5">
              <path d="M6.28 5.22a.75.75 0 00-1.06 1.06L8.94 10l-3.72 3.72a.75.75 0 101.06 1.06L10 11.06l3.72 3.72a.75.75 0 101.06-1.06L11.06 10l3.72-3.72a.75.75 0 00-1.06-1.06L10 8.94 6.28 5.22z" />
            </svg>
          </button>
        </div>

        <div class="projects-modal-body">
          <!-- Save New Project Section -->
          <div class="save-project-section">
            <h3 class="section-title">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-5 h-5">
                <path d="M10.75 4.75a.75.75 0 00-1.5 0v4.5h-4.5a.75.75 0 000 1.5h4.5v4.5a.75.75 0 001.5 0v-4.5h4.5a.75.75 0 000-1.5h-4.5v-4.5z" />
              </svg>
              Save Current Design
            </h3>
            <form id="saveProjectForm" class="save-project-form" onsubmit="handleSaveProject(event)">
              <div class="form-row-group">
                <div class="form-row form-row-half">
                  <label for="saveProjectStore">Store</label>
                  <select id="saveProjectStore" required onchange="updateSalespersonDropdown()">
                    <option value="">Select Store...</option>
                  </select>
                </div>
                <div class="form-row form-row-half">
                  <label for="saveProjectSalesperson">Salesperson</label>
                  <select id="saveProjectSalesperson" required>
                    <option value="">Select Person...</option>
                  </select>
                </div>
              </div>
              <div class="form-row">
                <label for="saveProjectName">Project Name</label>
                <input
                  type="text"
                  id="saveProjectName"
                  placeholder="e.g., Smith Residence - Backyard Deck"
                  required
                  maxlength="100"
                />
              </div>
              <div class="form-row customer-info-row">
                <div class="customer-info-toggle">
                  <label>
                    <input type="checkbox" id="includeCustomerInfo" onchange="toggleCustomerInfoFields()">
                    <span>Include Customer Info</span>
                  </label>
                </div>
              </div>
              <div id="customerInfoFields" class="customer-info-fields hidden">
                <div class="form-row">
                  <label for="customerName">Customer Name</label>
                  <input type="text" id="customerName" placeholder="John Smith" maxlength="100" />
                </div>
                <div class="form-row">
                  <label for="customerPhone">Phone</label>
                  <input type="tel" id="customerPhone" placeholder="(555) 123-4567" maxlength="20" />
                </div>
                <div class="form-row">
                  <label for="customerEmail">Email</label>
                  <input type="email" id="customerEmail" placeholder="john@example.com" maxlength="100" />
                </div>
                <div class="form-row">
                  <label for="customerAddress">Address</label>
                  <input type="text" id="customerAddress" placeholder="123 Main St, City" maxlength="200" />
                </div>
              </div>
              <button type="submit" class="btn btn-primary save-project-btn">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-4 h-4">
                  <path d="M10.75 2.75a.75.75 0 00-1.5 0v8.614L6.295 8.235a.75.75 0 10-1.09 1.03l4.25 4.5a.75.75 0 001.09 0l4.25-4.5a.75.75 0 00-1.09-1.03l-2.955 3.129V2.75z" />
                  <path d="M3.5 12.75a.75.75 0 00-1.5 0v2.5A2.75 2.75 0 004.75 18h10.5A2.75 2.75 0 0018 15.25v-2.5a.75.75 0 00-1.5 0v2.5c0 .69-.56 1.25-1.25 1.25H4.75c-.69 0-1.25-.56-1.25-1.25v-2.5z" />
                </svg>
                Save Project
              </button>
            </form>
          </div>

          <!-- Saved Projects List -->
          <div class="saved-projects-section">
            <h3 class="section-title">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-5 h-5">
                <path fill-rule="evenodd" d="M2 4.75C2 3.784 2.784 3 3.75 3h4.836c.464 0 .909.184 1.237.513l1.414 1.414a.25.25 0 00.177.073h4.836c.966 0 1.75.784 1.75 1.75v8.5A1.75 1.75 0 0116.25 17H3.75A1.75 1.75 0 012 15.25V4.75zm10.25 7a.75.75 0 000 1.5h2a.75.75 0 000-1.5h-2z" clip-rule="evenodd" />
              </svg>
              Saved Projects
              <span id="projectsCount" class="projects-count"></span>
            </h3>
            <div class="projects-filters">
              <div class="filter-row">
                <div class="filter-group">
                  <label for="filterStore">Store:</label>
                  <select id="filterStore" onchange="onStoreFilterChange()">
                    <option value="all">All Stores</option>
                  </select>
                </div>
                <div class="filter-group">
                  <label for="filterSalesperson">Person:</label>
                  <select id="filterSalesperson" onchange="renderProjectsList()">
                    <option value="all">All</option>
                  </select>
                </div>
                <div class="filter-group">
                  <label for="filterYear">Year:</label>
                  <select id="filterYear" onchange="renderProjectsList()">
                    <option value="all">All Years</option>
                  </select>
                </div>
              </div>
            </div>
            <div id="projectsList" class="projects-list">
              <div class="no-projects">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-12 h-12">
                  <path d="M2 4.75C2 3.784 2.784 3 3.75 3h4.836c.464 0 .909.184 1.237.513l1.414 1.414a.25.25 0 00.177.073h4.836c.966 0 1.75.784 1.75 1.75v8.5A1.75 1.75 0 0116.25 17H3.75A1.75 1.75 0 012 15.25V4.75z" />
                </svg>
                <p>No saved projects yet</p>
                <span>Save your current design to access it later</span>
              </div>
            </div>
          </div>
        </div>

        <div class="projects-modal-footer">
          <p class="storage-notice">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-4 h-4">
              <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a.75.75 0 000 1.5h.253a.25.25 0 01.244.304l-.459 2.066A1.75 1.75 0 0010.747 15H11a.75.75 0 000-1.5h-.253a.25.25 0 01-.244-.304l.459-2.066A1.75 1.75 0 009.253 9H9z" clip-rule="evenodd" />
            </svg>
            Projects are saved to your browser's local storage
          </p>
          <button type="button" class="btn btn-secondary" onclick="closeProjectsModal()">Close</button>
        </div>
      </div>
    </div>

    <!-- Settings Modal -->
    <div id="settingsModal" class="settings-modal hidden" onclick="if(event.target === this) closeSettingsModal()">
      <div class="settings-modal-content">
        <div class="settings-modal-header">
          <div class="settings-modal-title">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-6 h-6">
              <path fill-rule="evenodd" d="M7.84 1.804A1 1 0 018.82 1h2.36a1 1 0 01.98.804l.331 1.652a6.993 6.993 0 011.929 1.115l1.598-.54a1 1 0 011.186.447l1.18 2.044a1 1 0 01-.205 1.251l-1.267 1.113a7.047 7.047 0 010 2.228l1.267 1.113a1 1 0 01.206 1.25l-1.18 2.045a1 1 0 01-1.187.447l-1.598-.54a6.993 6.993 0 01-1.929 1.115l-.33 1.652a1 1 0 01-.98.804H8.82a1 1 0 01-.98-.804l-.331-1.652a6.993 6.993 0 01-1.929-1.115l-1.598.54a1 1 0 01-1.186-.447l-1.18-2.044a1 1 0 01.205-1.251l1.267-1.114a7.05 7.05 0 010-2.227L1.821 7.773a1 1 0 01-.206-1.25l1.18-2.045a1 1 0 011.187-.447l1.598.54A6.993 6.993 0 017.51 3.456l.33-1.652zM10 13a3 3 0 100-6 3 3 0 000 6z" clip-rule="evenodd" />
            </svg>
            <h2>Settings</h2>
          </div>
          <button type="button" class="settings-modal-close" onclick="closeSettingsModal()" title="Close">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-5 h-5">
              <path d="M6.28 5.22a.75.75 0 00-1.06 1.06L8.94 10l-3.72 3.72a.75.75 0 101.06 1.06L10 11.06l3.72 3.72a.75.75 0 101.06-1.06L11.06 10l3.72-3.72a.75.75 0 00-1.06-1.06L10 8.94 6.28 5.22z" />
            </svg>
          </button>
        </div>

        <div class="settings-modal-body">
          <div class="settings-section">
            <h3 class="settings-section-title">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-5 h-5">
                <path d="M10 8a3 3 0 100-6 3 3 0 000 6zM3.465 14.493a1.23 1.23 0 00.41 1.412A9.957 9.957 0 0010 18c2.31 0 4.438-.784 6.131-2.1.43-.333.604-.903.408-1.41a7.002 7.002 0 00-13.074.003z" />
              </svg>
              Stores & Salespeople
            </h3>
            <div id="storesList" class="stores-list">
              <!-- Dynamically populated -->
            </div>
            <div class="add-store-section">
              <input type="text" id="newStoreName" placeholder="New store name..." maxlength="50" aria-label="New store name" />
              <button type="button" class="btn btn-secondary btn-sm" onclick="handleAddStore()">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-4 h-4">
                  <path d="M10.75 4.75a.75.75 0 00-1.5 0v4.5h-4.5a.75.75 0 000 1.5h4.5v4.5a.75.75 0 001.5 0v-4.5h4.5a.75.75 0 000-1.5h-4.5v-4.5z" />
                </svg>
                Add Store
              </button>
            </div>
          </div>

          <div class="settings-notice">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-4 h-4">
              <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a.75.75 0 000 1.5h.253a.25.25 0 01.244.304l-.459 2.066A1.75 1.75 0 0010.747 15H11a.75.75 0 000-1.5h-.253a.25.25 0 01-.244-.304l.459-2.066A1.75 1.75 0 009.253 9H9z" clip-rule="evenodd" />
            </svg>
            <span>Deleting a salesperson won't delete their projects. Projects will show as "Unknown" until reassigned.</span>
          </div>

          <div class="settings-section settings-section-password">
            <h3 class="settings-section-title">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-5 h-5">
                <path fill-rule="evenodd" d="M10 1a4.5 4.5 0 00-4.5 4.5V9H5a2 2 0 00-2 2v6a2 2 0 002 2h10a2 2 0 002-2v-6a2 2 0 00-2-2h-.5V5.5A4.5 4.5 0 0010 1zm3 8V5.5a3 3 0 10-6 0V9h6z" clip-rule="evenodd" />
              </svg>
              Admin Password
            </h3>
            <div class="change-password-form">
              <input type="password" id="newAdminPassword" placeholder="New password..." minlength="4" aria-label="New admin password" />
              <input type="password" id="confirmAdminPassword" placeholder="Confirm password..." minlength="4" aria-label="Confirm admin password" />
              <button type="button" class="btn btn-secondary btn-sm" onclick="handleChangePassword()">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-4 h-4">
                  <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.857-9.809a.75.75 0 00-1.214-.882l-3.483 4.79-1.88-1.88a.75.75 0 10-1.06 1.061l2.5 2.5a.75.75 0 001.137-.089l4-5.5z" clip-rule="evenodd" />
                </svg>
                Update Password
              </button>
            </div>
          </div>
        </div>

        <div class="settings-modal-footer">
          <button type="button" class="btn btn-secondary" onclick="closeSettingsModal()">Close</button>
        </div>
      </div>
    </div>
  </body>
</html>
