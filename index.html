<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>TUDS Pro Deck Estimator</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="deckcalculatorstyles.css" />
    <script src="deckCalcjs/app.js?v=8" type="module"></script>
  </head>
  <body class="bg-gray-200 p-4 md:p-8">
    <div class="container mx-auto max-w-7xl">
      <div class="deck-calculator-header">
        <div class="header-content">
          <img
            src="https://tuds.ca/cdn/shop/files/TUDS_logo.svg?v=1676653488"
            alt="The Ultimate Deck Shop"
            class="header-logo"
          />
          <div class="header-text">
            <h1 class="text-2xl md:text-3xl font-bold text-white">
              TUDS Pro Deck Estimator
            </h1>
            <p class="header-subtitle">by The Ultimate Deck Shop</p>
          </div>
        </div>
        <button type="button" id="helpWizardBtn" class="help-wizard-trigger" title="Help & Tutorial" onclick="startHelpWizard()">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-5 h-5">
            <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zM8.94 6.94a.75.75 0 11-1.061-1.061 3 3 0 112.871 5.026v.345a.75.75 0 01-1.5 0v-.5c0-.72.57-1.172 1.081-1.287A1.5 1.5 0 108.94 6.94zM10 15a1 1 0 100-2 1 1 0 000 2z" clip-rule="evenodd" />
          </svg>
          <span>Help</span>
        </button>
      </div>

      <!-- Tab Navigation -->
      <div class="tab-navigation">
        <div class="tab-list" role="tablist">
          <button
            class="tab-button active"
            id="structure-tab"
            role="tab"
            aria-selected="true"
            aria-controls="structure-content"
            onclick="switchTab('structure')"
          >
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="tab-icon">
              <rect x="2" y="3" width="20" height="14" rx="2" ry="2"/>
              <line x1="8" y1="21" x2="16" y2="21"/>
              <line x1="12" y1="17" x2="12" y2="21"/>
            </svg>
            <span class="tab-label">Structure</span>
          </button>
          
          <button
            class="tab-button"
            id="decking-tab"
            role="tab"
            aria-selected="false"
            aria-controls="decking-content"
            onclick="switchTab('decking')"
          >
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="tab-icon">
              <rect x="3" y="3" width="18" height="18" rx="2" ry="2"/>
              <line x1="9" y1="9" x2="15" y2="15"/>
              <line x1="15" y1="9" x2="9" y2="15"/>
            </svg>
            <span class="tab-label">Decking</span>
            <span class="coming-soon-badge">Coming Soon</span>
          </button>
          
          <button
            class="tab-button"
            id="railing-tab"
            role="tab"
            aria-selected="false"
            aria-controls="railing-content"
            onclick="switchTab('railing')"
          >
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="tab-icon">
              <line x1="3" y1="6" x2="21" y2="6"/>
              <line x1="3" y1="12" x2="21" y2="12"/>
              <line x1="3" y1="18" x2="21" y2="18"/>
            </svg>
            <span class="tab-label">Railing</span>
            <span class="coming-soon-badge">Coming Soon</span>
          </button>
          
          <button
            class="tab-button"
            id="summary-tab"
            role="tab"
            aria-selected="false"
            aria-controls="summary-content"
            onclick="switchTab('summary')"
          >
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="tab-icon">
              <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
              <polyline points="14,2 14,8 20,8"/>
              <line x1="16" y1="13" x2="8" y2="13"/>
              <line x1="16" y1="17" x2="8" y2="17"/>
              <polyline points="10,9 9,9 8,9"/>
            </svg>
            <span class="tab-label">Enhanced Summary</span>
            <span class="coming-soon-badge">Coming Soon</span>
          </button>
        </div>
      </div>

      <!-- Tab Content Container -->
      <div class="tab-content-container">
        <!-- Structure Tab Content -->
        <div
          id="structure-content"
          class="tab-content active"
          role="tabpanel"
          aria-labelledby="structure-tab"
        >
          <div id="main-layout-container" class="flex flex-col lg:flex-row gap-8">
            <div id="input-panel" class="lg:w-1/4">
          <div class="info-card contextual-panel">
            
            <!-- Drawing Mode Section -->
            <div id="drawing-mode-panel" class="panel-section active">
              <h2 class="panel-title">Draw Your Deck</h2>
              <div class="panel-content">
                <!-- Template Gallery Section -->
                <div class="template-gallery">
                  <div class="template-gallery-header">
                    <span class="template-gallery-title">Quick Start Templates</span>
                    <button type="button" class="template-toggle-btn" onclick="toggleTemplateGallery()" title="Toggle templates">
                      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-4 h-4 toggle-icon">
                        <path fill-rule="evenodd" d="M5.23 7.21a.75.75 0 011.06.02L10 11.168l3.71-3.938a.75.75 0 111.08 1.04l-4.25 4.5a.75.75 0 01-1.08 0l-4.25-4.5a.75.75 0 01.02-1.06z" clip-rule="evenodd" />
                      </svg>
                    </button>
                  </div>
                  <div class="template-grid" id="templateGrid">
                    <button type="button" class="template-card" onclick="loadTemplate('rectangle-12x16')" title="12' x 16' Rectangle">
                      <div class="template-preview">
                        <svg viewBox="0 0 60 40" class="template-svg">
                          <rect x="10" y="8" width="40" height="24" fill="none" stroke="currentColor" stroke-width="2"/>
                        </svg>
                      </div>
                      <span class="template-label">Rectangle</span>
                      <span class="template-size">12' x 16'</span>
                    </button>
                    <button type="button" class="template-card" onclick="loadTemplate('rectangle-16x20')" title="16' x 20' Rectangle">
                      <div class="template-preview">
                        <svg viewBox="0 0 60 40" class="template-svg">
                          <rect x="8" y="6" width="44" height="28" fill="none" stroke="currentColor" stroke-width="2"/>
                        </svg>
                      </div>
                      <span class="template-label">Large Rect</span>
                      <span class="template-size">16' x 20'</span>
                    </button>
                    <button type="button" class="template-card" onclick="loadTemplate('l-shape-left')" title="L-Shape (Left)">
                      <div class="template-preview">
                        <svg viewBox="0 0 60 40" class="template-svg">
                          <path d="M8 6 L8 34 L36 34 L36 20 L52 20 L52 6 Z" fill="none" stroke="currentColor" stroke-width="2"/>
                        </svg>
                      </div>
                      <span class="template-label">L-Shape</span>
                      <span class="template-size">Left</span>
                    </button>
                    <button type="button" class="template-card" onclick="loadTemplate('l-shape-right')" title="L-Shape (Right)">
                      <div class="template-preview">
                        <svg viewBox="0 0 60 40" class="template-svg">
                          <path d="M8 6 L8 20 L24 20 L24 34 L52 34 L52 6 Z" fill="none" stroke="currentColor" stroke-width="2"/>
                        </svg>
                      </div>
                      <span class="template-label">L-Shape</span>
                      <span class="template-size">Right</span>
                    </button>
                    <button type="button" class="template-card" onclick="loadTemplate('u-shape')" title="U-Shape Wrap">
                      <div class="template-preview">
                        <svg viewBox="0 0 60 40" class="template-svg">
                          <path d="M6 6 L6 34 L54 34 L54 6 L40 6 L40 22 L20 22 L20 6 Z" fill="none" stroke="currentColor" stroke-width="2"/>
                        </svg>
                      </div>
                      <span class="template-label">U-Shape</span>
                      <span class="template-size">Wrap</span>
                    </button>
                    <button type="button" class="template-card" onclick="loadTemplate('notched')" title="Notched Corner">
                      <div class="template-preview">
                        <svg viewBox="0 0 60 40" class="template-svg">
                          <path d="M8 6 L8 34 L52 34 L52 18 L36 18 L36 6 Z" fill="none" stroke="currentColor" stroke-width="2"/>
                        </svg>
                      </div>
                      <span class="template-label">Notched</span>
                      <span class="template-size">Corner</span>
                    </button>
                  </div>
                </div>

                <div class="template-divider">
                  <span>or draw custom shape</span>
                </div>

                <div class="drawing-instructions">
                  <p class="instruction-text">Click on the grid to place your first point. The first point will snap to 1-foot increments.</p>
                </div>
                <div class="deck-specifications">
                  <form id="deckSpecsForm" class="space-y-4">
                    <div>
                      <label class="form-label">Deck Height <span class="tooltip-icon" data-tooltip="Height from ground to top of deck surface. Affects post length and stair requirements.">?</span></label>
                      <div class="flex gap-2 mt-1">
                        <div class="flex-1">
                          <select
                            id="deckHeightFeet"
                            name="deckHeightFeet"
                            class="form-select"
                          >
                            <option value="1">1'</option>
                            <option value="2">2'</option>
                            <option value="3">3'</option>
                            <option value="4" selected>4'</option>
                            <option value="5">5'</option>
                            <option value="6">6'</option>
                            <option value="7">7'</option>
                            <option value="8">8'</option>
                            <option value="9">9'</option>
                            <option value="10">10'</option>
                            <option value="11">11'</option>
                            <option value="12">12'</option>
                          </select>
                        </div>
                        <div class="flex-1">
                          <select
                            id="deckHeightInchesInput"
                            name="deckHeightInchesInput"
                            class="form-select"
                          >
                            <option value="0" selected>0"</option>
                            <option value="1">1"</option>
                            <option value="2">2"</option>
                            <option value="3">3"</option>
                            <option value="4">4"</option>
                            <option value="5">5"</option>
                            <option value="6">6"</option>
                            <option value="7">7"</option>
                            <option value="8">8"</option>
                            <option value="9">9"</option>
                            <option value="10">10"</option>
                            <option value="11">11"</option>
                          </select>
                        </div>
                      </div>
                    </div>
                    <!-- Footing Type Visual Selector -->
                    <div class="visual-selector compact" data-selector="footingType">
                      <div class="visual-selector-label">
                        Footing Type <span class="tooltip-icon" data-tooltip="Foundation system that supports your deck posts. Choice affects stability, cost, and installation method.">?</span>
                      </div>
                      <div class="visual-selector-grid three-col">
                        <div class="visual-option selected" data-value="gh_levellers">
                          <div class="visual-option-icon">
                            <svg viewBox="0 0 36 36" fill="none" stroke="currentColor" stroke-width="2">
                              <rect x="6" y="24" width="24" height="6" rx="1"/>
                              <rect x="12" y="16" width="12" height="8"/>
                              <line x1="18" y1="8" x2="18" y2="16"/>
                              <circle cx="18" cy="6" r="2"/>
                            </svg>
                          </div>
                          <div class="visual-option-name">GH Levellers</div>
                          <div class="visual-option-desc">+ 16x16 Slab</div>
                        </div>
                        <div class="visual-option" data-value="pylex">
                          <div class="visual-option-icon">
                            <svg viewBox="0 0 36 36" fill="none" stroke="currentColor" stroke-width="2">
                              <path d="M18 6 L18 30"/>
                              <path d="M14 28 L18 34 L22 28"/>
                              <path d="M12 10 L24 10"/>
                              <circle cx="18" cy="6" r="2"/>
                            </svg>
                          </div>
                          <div class="visual-option-name">Pylex</div>
                          <div class="visual-option-desc">50" Screw Piles</div>
                        </div>
                        <div class="visual-option" data-value="helical">
                          <div class="visual-option-icon">
                            <svg viewBox="0 0 36 36" fill="none" stroke="currentColor" stroke-width="2">
                              <path d="M18 4 L18 32"/>
                              <ellipse cx="18" cy="28" rx="8" ry="3"/>
                              <ellipse cx="18" cy="22" rx="6" ry="2"/>
                              <rect x="14" y="2" width="8" height="4"/>
                            </svg>
                          </div>
                          <div class="visual-option-name">Helical</div>
                          <div class="visual-option-desc">10' Piles</div>
                        </div>
                      </div>
                      <select id="footingType" name="footingType" class="hidden-select">
                        <option value="gh_levellers" selected>GH Levellers + 16x16 Slab</option>
                        <option value="pylex">Pylex 50" Screw Piles</option>
                        <option value="helical">10' Helical Piles</option>
                      </select>
                    </div>
                    <div>
                      <label for="postSize" class="form-label">Post Size <span class="tooltip-icon" data-tooltip="Vertical support posts. 4x4 uses 2-ply beams, 6x6 uses 3-ply beams. 'App Decides' selects based on your deck size.">?</span></label>
                      <select id="postSize" name="postSize" class="form-select">
                        <option value="auto" selected>App Decides</option>
                        <option value="4x4">4x4 Posts (2-ply beams)</option>
                        <option value="6x6">6x6 Posts (3-ply beams)</option>
                      </select>
                    </div>
                    <div>
                      <label for="joistSpacing" class="form-label">Joist Spacing <span class="tooltip-icon" data-tooltip="Distance between joists measured 'On Center' (OC). 16&quot; is standard; 12&quot; provides extra strength for heavy loads or longer spans.">?</span></label>
                      <select
                        id="joistSpacing"
                        name="joistSpacing"
                        class="form-select"
                      >
                        <option value="16">16" OC</option>
                        <option value="12">12" OC</option>
                      </select>
                    </div>
                    <div>
                      <label for="attachmentType" class="form-label">Attachment Type <span class="tooltip-icon" data-tooltip="How the deck connects to your house. Ledger attaches to house rim, Concrete bolts to foundation, Floating is freestanding.">?</span></label>
                      <select
                        id="attachmentType"
                        name="attachmentType"
                        class="form-select"
                      >
                        <option value="house_rim">House Rim (Ledger)</option>
                        <option value="concrete">Concrete Foundation</option>
                        <option value="floating">Floating</option>
                      </select>
                    </div>
                    <!-- Beam Type Visual Selector -->
                    <div class="visual-selector compact" data-selector="beamType">
                      <div class="visual-selector-label">
                        Beam Type <span class="tooltip-icon" data-tooltip="Drop beam sits below joists (easier install). Flush beam is level with joists (lower profile, more hardware).">?</span>
                      </div>
                      <div class="visual-selector-grid two-col">
                        <div class="visual-option selected" data-value="drop">
                          <div class="visual-option-icon">
                            <svg viewBox="0 0 36 36" fill="none" stroke="currentColor" stroke-width="2">
                              <!-- Joists on top -->
                              <rect x="4" y="8" width="4" height="12"/>
                              <rect x="16" y="8" width="4" height="12"/>
                              <rect x="28" y="8" width="4" height="12"/>
                              <!-- Beam below -->
                              <rect x="2" y="22" width="32" height="6" fill="currentColor" opacity="0.3"/>
                              <!-- Post -->
                              <rect x="15" y="28" width="6" height="6"/>
                            </svg>
                          </div>
                          <div class="visual-option-name">Drop Beam</div>
                          <div class="visual-option-desc">Below joists</div>
                        </div>
                        <div class="visual-option" data-value="flush">
                          <div class="visual-option-icon">
                            <svg viewBox="0 0 36 36" fill="none" stroke="currentColor" stroke-width="2">
                              <!-- Beam flush with joists -->
                              <rect x="2" y="10" width="32" height="6" fill="currentColor" opacity="0.3"/>
                              <!-- Joists same level -->
                              <rect x="4" y="10" width="4" height="12"/>
                              <rect x="16" y="10" width="4" height="12"/>
                              <rect x="28" y="10" width="4" height="12"/>
                              <!-- Hangers -->
                              <path d="M8 10 L8 16 L12 16 L12 10" stroke-width="1"/>
                              <path d="M24 10 L24 16 L28 16 L28 10" stroke-width="1"/>
                              <!-- Post -->
                              <rect x="15" y="22" width="6" height="12"/>
                            </svg>
                          </div>
                          <div class="visual-option-name">Flush Beam</div>
                          <div class="visual-option-desc">Level with joists</div>
                        </div>
                      </div>
                      <select id="beamType" name="beamType" class="hidden-select">
                        <option value="drop" selected>Drop Beam</option>
                        <option value="flush">Flush Beam</option>
                      </select>
                    </div>
                    <!-- Picture Frame Visual Selector -->
                    <div class="visual-selector compact" data-selector="pictureFrame">
                      <div class="visual-selector-label">
                        Picture Frame <span class="tooltip-icon" data-tooltip="Decorative border around deck perimeter. Single is one board width, Double is two boards for a bolder look.">?</span>
                      </div>
                      <div class="visual-selector-grid three-col">
                        <div class="visual-option selected" data-value="none">
                          <div class="visual-option-icon">
                            <svg viewBox="0 0 36 36" fill="none" stroke="currentColor" stroke-width="1.5">
                              <!-- Simple deck boards -->
                              <line x1="6" y1="8" x2="6" y2="28"/>
                              <line x1="12" y1="8" x2="12" y2="28"/>
                              <line x1="18" y1="8" x2="18" y2="28"/>
                              <line x1="24" y1="8" x2="24" y2="28"/>
                              <line x1="30" y1="8" x2="30" y2="28"/>
                              <rect x="4" y="6" width="28" height="24" stroke-dasharray="2 2"/>
                            </svg>
                          </div>
                          <div class="visual-option-name">None</div>
                        </div>
                        <div class="visual-option" data-value="single">
                          <div class="visual-option-icon">
                            <svg viewBox="0 0 36 36" fill="none" stroke="currentColor" stroke-width="1.5">
                              <!-- Deck boards -->
                              <line x1="10" y1="10" x2="10" y2="26"/>
                              <line x1="15" y1="10" x2="15" y2="26"/>
                              <line x1="20" y1="10" x2="20" y2="26"/>
                              <line x1="25" y1="10" x2="25" y2="26"/>
                              <!-- Single frame -->
                              <rect x="4" y="4" width="28" height="28" stroke-width="3" stroke="currentColor"/>
                            </svg>
                          </div>
                          <div class="visual-option-name">Single</div>
                        </div>
                        <div class="visual-option" data-value="double">
                          <div class="visual-option-icon">
                            <svg viewBox="0 0 36 36" fill="none" stroke="currentColor" stroke-width="1.5">
                              <!-- Deck boards -->
                              <line x1="12" y1="12" x2="12" y2="24"/>
                              <line x1="16" y1="12" x2="16" y2="24"/>
                              <line x1="20" y1="12" x2="20" y2="24"/>
                              <line x1="24" y1="12" x2="24" y2="24"/>
                              <!-- Double frame -->
                              <rect x="2" y="2" width="32" height="32" stroke-width="2"/>
                              <rect x="6" y="6" width="24" height="24" stroke-width="2"/>
                            </svg>
                          </div>
                          <div class="visual-option-name">Double</div>
                        </div>
                      </div>
                      <select id="pictureFrame" name="pictureFrame" class="hidden-select">
                        <option value="none" selected>None</option>
                        <option value="single">Single</option>
                        <option value="double">Double</option>
                      </select>
                    </div>
                    <div>
                      <label for="joistProtection" class="form-label">Joist Protection <span class="tooltip-icon" data-tooltip="Protective barrier on joist tops to prevent moisture damage and extend lifespan. G-Tape is self-adhesive flashing.">?</span></label>
                      <select
                        id="joistProtection"
                        name="joistProtection"
                        class="form-select"
                      >
                        <option value="none" selected>None</option>
                        <option value="gtape">G-Tape</option>
                        <option value="coating">Deck Coating</option>
                      </select>
                    </div>
                    <div>
                      <label for="fasteners" class="form-label">Framing Fasteners <span class="tooltip-icon" data-tooltip="Screws or nails for structural framing. U2 and Paslode are premium structural fasteners for faster installation.">?</span></label>
                      <select id="fasteners" name="fasteners" class="form-select">
                        <option value="screws_3in">3" Deck Screws</option>
                        <option value="u2_3_18">U2 3-1/8"</option>
                        <option value="paslode_3_14">Paslode 3-1/4"</option>
                      </select>
                    </div>
                  </form>
                </div>
              </div>
            </div>

            <!-- Wall Selection Mode Section -->
            <div id="wall-selection-panel" class="panel-section hidden">
              <h2 class="panel-title">Select Wall Segments for Ledger</h2>
              <div class="panel-content">
                <div class="instruction-box">
                  <p>Click wall edge(s) that will be attached to your house or structure. You can select multiple parallel wall segments.</p>
                  <p class="mt-2 text-sm">ðŸ’¡ All selected walls must be parallel. Click a selected wall to deselect it.</p>
                </div>
                
                <div class="primary-action">
                  <button id="generatePlanBtn" class="btn btn-primary btn-full-width btn-large">
                    Generate Plan
                  </button>
                </div>
              </div>
            </div>


            <!-- Plan Generated Section -->
            <div id="plan-generated-panel" class="panel-section hidden">
              <h2 class="panel-title">Your Deck Plan</h2>
              <div class="panel-content">
                <!-- Top action buttons -->
                <div class="top-action-buttons flex gap-3 mb-4">
                  <button type="button" id="mainStairsBtn" class="btn btn-primary flex-1" onclick="handleMainStairsButton()">
                    +/- Stairs
                  </button>
                  <button type="button" class="btn btn-secondary flex-1 modify-specs-btn" onclick="toggleSpecEditor()">
                    Modify
                  </button>
                </div>
                
                <!-- Stair Management Section (hidden by default, moved to top) -->
                <div id="stairManagementSection" class="stair-management-section hidden">
                  <div class="flex justify-between items-center mb-3">
                    <h3 class="text-lg font-semibold text-[#333333]">Stairs</h3>
                    <span id="stairCount" class="text-sm text-gray-600">0 sets</span>
                  </div>
                  
                  <div id="stairList" class="stair-list space-y-2 mb-4">
                    <!-- Stairs will be dynamically populated here -->
                  </div>
                  
                </div>
                
                <!-- Quick Specs summary -->
                <div id="summarySection">
                  <h3 class="text-lg font-semibold mb-2 text-[#333333]">
                    Quick Specs
                  </h3>
                  <dl id="summaryList" class="summary-list text-sm"></dl>

                  <!-- View Full Specifications Button -->
                  <button type="button" id="viewSpecsBtn" class="view-specs-btn hidden" onclick="openSpecsModal()">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-4 h-4">
                      <path fill-rule="evenodd" d="M16.403 12.652a3 3 0 000-5.304 3 3 0 00-3.75-3.751 3 3 0 00-5.305 0 3 3 0 00-3.751 3.75 3 3 0 000 5.305 3 3 0 003.75 3.751 3 3 0 005.305 0 3 3 0 003.751-3.75zm-2.546-4.46a.75.75 0 00-1.214-.883l-3.483 4.79-1.88-1.88a.75.75 0 10-1.06 1.061l2.5 2.5a.75.75 0 001.137-.089l4-5.5z" clip-rule="evenodd" />
                    </svg>
                    View Full Specifications
                    <span class="permit-badge-small">Permit-Ready</span>
                  </button>
                </div>
                
                <!-- Full specification editor (replaces summary when active) -->
                <div class="spec-editor hidden">
                  <div class="deck-specifications">
                    <form id="modifySpecsForm" class="space-y-4">
                      <div>
                        <label class="form-label">Deck Height</label>
                        <div class="flex gap-2 mt-1">
                          <div class="flex-1">
                            <select id="modifyHeightFeet" class="form-select">
                              <option value="1">1'</option>
                              <option value="2">2'</option>
                              <option value="3">3'</option>
                              <option value="4" selected>4'</option>
                              <option value="5">5'</option>
                              <option value="6">6'</option>
                              <option value="7">7'</option>
                              <option value="8">8'</option>
                              <option value="9">9'</option>
                              <option value="10">10'</option>
                              <option value="11">11'</option>
                              <option value="12">12'</option>
                            </select>
                          </div>
                          <div class="flex-1">
                            <select id="modifyHeightInches" class="form-select">
                              <option value="0" selected>0"</option>
                              <option value="1">1"</option>
                              <option value="2">2"</option>
                              <option value="3">3"</option>
                              <option value="4">4"</option>
                              <option value="5">5"</option>
                              <option value="6">6"</option>
                              <option value="7">7"</option>
                              <option value="8">8"</option>
                              <option value="9">9"</option>
                              <option value="10">10"</option>
                              <option value="11">11"</option>
                            </select>
                          </div>
                        </div>
                      </div>
                      <div>
                        <label for="modifyFootingType" class="form-label">Footing Type</label>
                        <select id="modifyFootingType" name="footingType" class="form-select">
                          <option value="gh_levellers">GH Levellers + 16x16 Slab</option>
                          <option value="pylex">Pylex 50" Screw Piles</option>
                          <option value="helical">10' Helical Piles</option>
                        </select>
                      </div>
                      <div>
                        <label for="modifyPostSize" class="form-label">Post Size</label>
                        <select id="modifyPostSize" name="postSize" class="form-select">
                          <option value="auto">App Decides</option>
                          <option value="4x4">4x4 Posts (2-ply beams)</option>
                          <option value="6x6">6x6 Posts (3-ply beams)</option>
                        </select>
                      </div>
                      <div>
                        <label for="modifyJoistSpacing" class="form-label">Joist Spacing</label>
                        <select id="modifyJoistSpacing" name="joistSpacing" class="form-select">
                          <option value="16">16" OC</option>
                          <option value="12">12" OC</option>
                        </select>
                      </div>
                      <div>
                        <label for="modifyAttachmentType" class="form-label">Attachment Type</label>
                        <select id="modifyAttachmentType" name="attachmentType" class="form-select">
                          <option value="house_rim">House Rim (Ledger)</option>
                          <option value="concrete">Concrete Foundation</option>
                          <option value="floating">Floating</option>
                        </select>
                      </div>
                      <div>
                        <label for="modifyBeamType" class="form-label">Beam Type</label>
                        <select id="modifyBeamType" name="beamType" class="form-select">
                          <option value="drop">Drop Beam</option>
                          <option value="flush">Flush Beam</option>
                        </select>
                      </div>
                      <div>
                        <label for="modifyPictureFrame" class="form-label">Picture Frame</label>
                        <select id="modifyPictureFrame" name="pictureFrame" class="form-select">
                          <option value="none">None</option>
                          <option value="single">Single</option>
                          <option value="double">Double</option>
                        </select>
                      </div>
                      <div>
                        <label for="modifyJoistProtection" class="form-label">Joist Protection</label>
                        <select id="modifyJoistProtection" name="joistProtection" class="form-select">
                          <option value="none" selected>None</option>
                          <option value="gtape">G-Tape</option>
                          <option value="coating">Deck Coating</option>
                        </select>
                      </div>
                      <div>
                        <label for="modifyFasteners" class="form-label">Framing Fasteners</label>
                        <select id="modifyFasteners" name="fasteners" class="form-select">
                          <option value="screws_3in">3" Deck Screws</option>
                          <option value="u2_3_18">U2 3-1/8"</option>
                          <option value="paslode_3_14">Paslode 3-1/4"</option>
                        </select>
                      </div>
                      <div class="action-buttons">
                        <button type="button" class="btn btn-primary btn-full-width" onclick="regeneratePlan()">
                          Apply Changes
                        </button>
                        <button type="button" class="btn btn-secondary btn-full-width" onclick="toggleSpecEditor()">
                          Cancel
                        </button>
                      </div>
                    </form>
                  </div>
                </div>
              </div>
            </div>

            <!-- Stair Configuration Section -->
            <div id="stair-config-panel" class="panel-section hidden">
              <h2 class="panel-title">Configure Stairs</h2>
              <div class="panel-content">
                <div class="instruction-box">
                  <p>Configure your stair details below, then click a deck edge to place them.</p>
                  <p class="mt-2 text-sm">ðŸ’¡ You can add multiple sets of stairs by repeating this process.</p>
                </div>

                <div class="stair-specs">
                  <form id="stairSpecsForm" class="space-y-4">
                    <div>
                      <label for="stairWidth" class="form-label">Width</label>
                      <select id="stairWidth" name="stairWidth" class="form-select">
                        <option value="4">4' 0"</option>
                        <option value="5">5' 0"</option>
                        <option value="6">6' 0"</option>
                        <option value="7">7' 0"</option>
                        <option value="8">8' 0"</option>
                        <option value="9">9' 0"</option>
                        <option value="10">10' 0"</option>
                        <option value="11">11' 0"</option>
                        <option value="12">12' 0"</option>
                        <option value="13">13' 0"</option>
                        <option value="14">14' 0"</option>
                        <option value="15">15' 0"</option>
                        <option value="16">16' 0"</option>
                        <option value="17">17' 0"</option>
                        <option value="18">18' 0"</option>
                        <option value="19">19' 0"</option>
                        <option value="20">20' 0"</option>
                      </select>
                    </div>
                    <div>
                      <label for="stringerType" class="form-label"
                        >Stringer Type</label
                      >
                      <select
                        id="stringerType"
                        name="stringerType"
                        class="form-select"
                      >
                        <option value="pylex_steel">Pylex Steel (Pre-fab)</option>
                        <option value="lvl_wood">LVL Wood (Pre-fab)</option>
                        <option value="custom_2x12">Custom Cut 2x12</option>
                      </select>
                    </div>
                    <div>
                      <label for="landingType" class="form-label">Landing Type</label>
                      <select id="landingType" name="landingType" class="form-select">
                        <option value="existing">
                          Existing Surface (Ground/Patio)
                        </option>
                        <option value="slabs_16x16">16"x16" Slabs</option>
                        <option value="concrete_pad">Poured Concrete Pad</option>
                      </select>
                    </div>
                  </form>
                </div>
                
                <div class="stair-actions">
                  <div class="flex gap-2 mb-3">
                    <button
                      type="button"
                      id="finishStairsBtn"
                      class="btn btn-primary btn-full-width"
                    >
                      Finish Adding
                    </button>
                  </div>
                  <p class="text-sm text-gray-600 mt-2">
                    Select options above, then click a deck edge (rim joist) to place the stairs.
                  </p>
                </div>
              </div>
            </div>

          </div>

          </div>

            <div id="main-content-panel" class="lg:w-3/4">
              <div class="info-card">
                <div
                  id="canvasContainerWrapper"
                  class="relative"
                >
                  <div id="dimensionInputContainer" class="flex items-center mb-2 hidden">
                    <label class="text-sm text-gray-600 mr-2">Enter length:</label>
                    <div class="flex flex-1 gap-2">
                      <input id="dimensionFeetInput" type="number" min="0" class="form-input text-sm py-1 px-2 w-16" placeholder="ft">
                      <input id="dimensionInchesInput" type="number" min="0" max="11" class="form-input text-sm py-1 px-2 w-16" placeholder="in">
                    </div>
                    <button id="applyDimensionBtn" class="btn btn-secondary text-xs px-3 py-1 leading-tight ml-2">Apply</button>
                    <button id="cancelDimensionBtn" class="btn btn-secondary text-xs px-3 py-1 leading-tight ml-2">Cancel</button>
                  </div>
                  <div id="canvasContainer" class="relative">
                    <canvas id="deckCanvas"></canvas>

                    <!-- Grid scale indicator -->
                    <div class="grid-scale-indicator">
                      <div class="scale-bar"></div>
                      <span class="scale-label">1 ft</span>
                    </div>

                    <!-- Floating control buttons -->
                    <div class="absolute top-2 right-2 flex items-center space-x-2 z-10 floating-controls">
                      <button
                        type="button"
                        id="undoBtn"
                        class="btn btn-secondary text-xs px-3 py-2 leading-tight shadow-lg btn-disabled"
                        title="Undo (Ctrl+Z)"
                        onclick="undo()"
                        disabled
                      >
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-5 h-5">
                          <path fill-rule="evenodd" d="M7.793 2.232a.75.75 0 01-.025 1.06L3.622 7.25h10.003a5.375 5.375 0 010 10.75H10.75a.75.75 0 010-1.5h2.875a3.875 3.875 0 000-7.75H3.622l4.146 3.957a.75.75 0 01-1.036 1.085l-5.5-5.25a.75.75 0 010-1.085l5.5-5.25a.75.75 0 011.06.025z" clip-rule="evenodd" />
                        </svg>
                      </button>
                      <button
                        type="button"
                        id="redoBtn"
                        class="btn btn-secondary text-xs px-3 py-2 leading-tight shadow-lg btn-disabled"
                        title="Redo (Ctrl+Y)"
                        onclick="redo()"
                        disabled
                      >
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-5 h-5">
                          <path fill-rule="evenodd" d="M12.207 2.232a.75.75 0 00.025 1.06l4.146 3.958H6.375a5.375 5.375 0 000 10.75H9.25a.75.75 0 000-1.5H6.375a3.875 3.875 0 010-7.75h10.003l-4.146 3.957a.75.75 0 001.036 1.085l5.5-5.25a.75.75 0 000-1.085l-5.5-5.25a.75.75 0 00-1.06.025z" clip-rule="evenodd" />
                        </svg>
                      </button>
                      <div class="floating-controls-divider"></div>
                      <button
                        type="button"
                        id="zoomInBtn"
                        class="btn btn-secondary text-xs px-3 py-2 leading-tight shadow-lg"
                        title="Zoom In"
                      >
                        <svg
                          xmlns="http://www.w3.org/2000/svg"
                          viewBox="0 0 20 20"
                          fill="currentColor"
                          class="w-5 h-5"
                        >
                          <path
                            d="M10.75 4.75a.75.75 0 0 0-1.5 0v4.5h-4.5a.75.75 0 0 0 0 1.5h4.5v4.5a.75.75 0 0 0 1.5 0v-4.5h4.5a.75.75 0 0 0 0-1.5h-4.5v-4.5Z"
                          />
                        </svg>
                      </button>
                      <button
                        type="button"
                        id="zoomOutBtn"
                        class="btn btn-secondary text-xs px-3 py-2 leading-tight shadow-lg"
                        title="Zoom Out"
                      >
                        <svg
                          xmlns="http://www.w3.org/2000/svg"
                          viewBox="0 0 20 20"
                          fill="currentColor"
                          class="w-5 h-5"
                        >
                          <path
                            fill-rule="evenodd"
                            d="M4 10a.75.75 0 0 1 .75-.75h10.5a.75.75 0 0 1 0 1.5H4.75A.75.75 0 0 1 4 10Z"
                            clip-rule="evenodd"
                          />
                        </svg>
                      </button>
                      <button
                        type="button"
                        id="centerFitBtn"
                        class="btn btn-secondary text-xs px-3 py-2 leading-tight shadow-lg"
                        title="Center & Fit"
                      >
                        <svg
                          xmlns="http://www.w3.org/2000/svg"
                          viewBox="0 0 24 24"
                          fill="none"
                          stroke="currentColor"
                          stroke-width="2"
                          stroke-linecap="round"
                          stroke-linejoin="round"
                          class="w-5 h-5"
                        >
                          <path d="M2 3h6v6H2z"/>
                          <path d="M16 3h6v6h-6z"/>
                          <path d="M16 15h6v6h-6z"/>
                          <path d="M2 15h6v6H2z"/>
                        </svg>
                      </button>
                      <button
                        id="blueprintToggleBtn"
                        class="btn btn-secondary text-xs px-3 py-2 leading-tight shadow-lg"
                        title="Blueprint View"
                      >
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-5 h-5">
                          <path d="M10 12.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z" />
                          <path fill-rule="evenodd" d="M.664 10.59a1.651 1.651 0 010-1.186A10.004 10.004 0 0110 3c4.257 0 7.893 2.66 9.336 6.41.147.381.146.804 0 1.186A10.004 10.004 0 0110 17c-4.257 0-7.893-2.66-9.336-6.41zM14 10a4 4 0 11-8 0 4 4 0 018 0z" clip-rule="evenodd" />
                        </svg>
                      </button>
                      <button
                        id="toggleDecompositionBtn"
                        class="btn btn-secondary text-xs px-3 py-2 leading-tight shadow-lg"
                        title="Show Sections"
                      >
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-5 h-5">
                          <path fill-rule="evenodd" d="M3 4.25A2.25 2.25 0 015.25 2h9.5A2.25 2.25 0 0117 4.25v2.5A2.25 2.25 0 0114.75 9h-9.5A2.25 2.25 0 013 6.75v-2.5zm2.25-.75a.75.75 0 00-.75.75v2.5c0 .414.336.75.75.75h9.5a.75.75 0 00.75-.75v-2.5a.75.75 0 00-.75-.75h-9.5z" clip-rule="evenodd" />
                          <path fill-rule="evenodd" d="M3 13.25A2.25 2.25 0 015.25 11h9.5A2.25 2.25 0 0117 13.25v2.5A2.25 2.25 0 0114.75 18h-9.5A2.25 2.25 0 013 15.75v-2.5zm2.25-.75a.75.75 0 00-.75.75v2.5c0 .414.336.75.75.75h9.5a.75.75 0 00.75-.75v-2.5a.75.75 0 00-.75-.75h-9.5z" clip-rule="evenodd" />
                        </svg>
                      </button>
                      <button
                        id="cutListModeBtn"
                        class="btn btn-secondary text-xs px-3 py-2 leading-tight shadow-lg"
                        title="Cut List Labels"
                        onclick="toggleCutListMode()"
                      >
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-5 h-5">
                          <path fill-rule="evenodd" d="M4.5 2A1.5 1.5 0 003 3.5v13A1.5 1.5 0 004.5 18h11a1.5 1.5 0 001.5-1.5V7.621a1.5 1.5 0 00-.44-1.06l-4.12-4.122A1.5 1.5 0 0011.378 2H4.5zm4.75 6.5a.75.75 0 00-1.5 0v2.25H5.5a.75.75 0 000 1.5h2.25v2.25a.75.75 0 001.5 0v-2.25h2.25a.75.75 0 000-1.5H9.25V8.5z" clip-rule="evenodd" />
                        </svg>
                      </button>
                      <button
                        id="preview3DBtn"
                        class="btn btn-secondary text-xs px-3 py-2 leading-tight shadow-lg"
                        title="3D Preview"
                        onclick="open3DPreview()"
                      >
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-5 h-5">
                          <path d="M10 3.5a1.5 1.5 0 013 0V4a1 1 0 001 1h3a1 1 0 011 1v3a1 1 0 01-1 1h-.5a1.5 1.5 0 000 3h.5a1 1 0 011 1v3a1 1 0 01-1 1h-3a1 1 0 01-1-1v-.5a1.5 1.5 0 00-3 0v.5a1 1 0 01-1 1H6a1 1 0 01-1-1v-3a1 1 0 00-1-1h-.5a1.5 1.5 0 010-3H4a1 1 0 001-1V6a1 1 0 011-1h3a1 1 0 001-1v-.5z" />
                        </svg>
                      </button>
                      <button
                        id="clearCanvasBtn"
                        class="btn btn-secondary text-xs px-3 py-2 leading-tight shadow-lg"
                        title="Clear Canvas"
                      >
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-5 h-5">
                          <path fill-rule="evenodd" d="M8.75 1A2.75 2.75 0 006 3.75v.443c-.795.077-1.584.176-2.365.298a.75.75 0 10.23 1.482l.149-.022.841 10.518A2.75 2.75 0 007.596 19h4.807a2.75 2.75 0 002.742-2.53l.841-10.52.149.023a.75.75 0 00.23-1.482A41.03 41.03 0 0014 4.193V3.75A2.75 2.75 0 0011.25 1h-2.5zM10 4c.84 0 1.673.025 2.5.075V3.75c0-.69-.56-1.25-1.25-1.25h-2.5c-.69 0-1.25.56-1.25 1.25v.325C8.327 4.025 9.16 4 10 4zM8.58 7.72a.75.75 0 00-1.5.06l.3 7.5a.75.75 0 101.5-.06l-.3-7.5zm4.34.06a.75.75 0 10-1.5-.06l-.3 7.5a.75.75 0 101.5.06l.3-7.5z" clip-rule="evenodd" />
                        </svg>
                      </button>
                    </div>

                    <!-- Floating Legend -->
                    <div class="floating-legend" id="floatingLegend">
                      <button class="floating-legend-toggle" onclick="document.getElementById('floatingLegend').classList.toggle('expanded')" title="Toggle Legend">
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-4 h-4">
                          <path fill-rule="evenodd" d="M2 4.75A.75.75 0 012.75 4h14.5a.75.75 0 010 1.5H2.75A.75.75 0 012 4.75zm0 10.5a.75.75 0 01.75-.75h7.5a.75.75 0 010 1.5h-7.5a.75.75 0 01-.75-.75zM2 10a.75.75 0 01.75-.75h14.5a.75.75 0 010 1.5H2.75A.75.75 0 012 10z" clip-rule="evenodd" />
                        </svg>
                        <span>Legend</span>
                      </button>
                      <div class="floating-legend-content">
                        <div class="legend-header">
                          <span>Show/Hide Layers</span>
                          <div class="legend-actions">
                            <button type="button" class="legend-action-btn" onclick="toggleAllLayers(true)" title="Show All">All</button>
                            <button type="button" class="legend-action-btn" onclick="toggleAllLayers(false)" title="Hide All">None</button>
                          </div>
                        </div>
                        <label class="legend-row legend-toggle">
                          <input type="checkbox" id="layer-outline" checked onchange="toggleLayerVisibility('outline')">
                          <span class="legend-color" style="background-color: #4A90E2;"></span>
                          <span class="legend-label">Outline</span>
                        </label>
                        <label class="legend-row legend-toggle">
                          <input type="checkbox" id="layer-dimensions" checked onchange="toggleLayerVisibility('dimensions')">
                          <span class="legend-color" style="background-color: #333333;"></span>
                          <span class="legend-label">Dimensions</span>
                        </label>
                        <label class="legend-row legend-toggle">
                          <input type="checkbox" id="layer-ledger" checked onchange="toggleLayerVisibility('ledger')">
                          <span class="legend-color" style="background-color: #f97316;"></span>
                          <span class="legend-label">Ledger</span>
                        </label>
                        <label class="legend-row legend-toggle">
                          <input type="checkbox" id="layer-joists" checked onchange="toggleLayerVisibility('joists')">
                          <span class="legend-color" style="background-color: #374151;"></span>
                          <span class="legend-label">Joists/Rim</span>
                        </label>
                        <label class="legend-row legend-toggle">
                          <input type="checkbox" id="layer-beams" checked onchange="toggleLayerVisibility('beams')">
                          <span class="legend-color" style="background-color: #dc2626;"></span>
                          <span class="legend-label">Beams</span>
                        </label>
                        <label class="legend-row legend-toggle">
                          <input type="checkbox" id="layer-posts" checked onchange="toggleLayerVisibility('posts')">
                          <span class="legend-color legend-color-post"></span>
                          <span class="legend-label">Posts/Footings</span>
                        </label>
                        <label class="legend-row legend-toggle">
                          <input type="checkbox" id="layer-blocking" checked onchange="toggleLayerVisibility('blocking')">
                          <span class="legend-color" style="background-color: #8B5CF6;"></span>
                          <span class="legend-label">Blocking</span>
                        </label>
                        <label class="legend-row legend-toggle">
                          <input type="checkbox" id="layer-stairs" checked onchange="toggleLayerVisibility('stairs')">
                          <span class="legend-color" style="background-color: #7c3aed;"></span>
                          <span class="legend-label">Stairs</span>
                        </label>
                      </div>
                    </div>
                  </div>
                </div>
              </div>

                <div id="bomSection" class="info-card hidden">
                  <div class="flex justify-between items-center mb-4">
                    <h2 class="text-xl font-semibold text-[#333333]">
                      Materials List
                    </h2>
                  </div>
                  
                  
                  <div class="flex justify-between items-center mb-4">
                    <div></div>
                    <div class="flex gap-2">
                      <button
                        type="button"
                        id="resetAllBomBtn"
                        class="btn btn-secondary px-3 py-1 text-sm"
                        onclick="resetAllQuantities()"
                        title="Reset all quantities to calculated values"
                      >
                        <svg
                          xmlns="http://www.w3.org/2000/svg"
                          viewBox="0 0 20 20"
                          fill="currentColor"
                          class="w-4 h-4 inline-block mr-1 align-text-bottom"
                        >
                          <path fill-rule="evenodd" d="M15.312 11.424a5.5 5.5 0 01-9.201 2.466l-.312-.311h2.433a.75.75 0 000-1.5H3.989a.75.75 0 00-.75.75v4.242a.75.75 0 001.5 0v-2.43l.31.31a7 7 0 0011.712-3.138.75.75 0 00-1.449-.39zm1.23-3.723a.75.75 0 00.219-.53V2.929a.75.75 0 00-1.5 0V5.36l-.31-.31A7 7 0 003.239 8.188a.75.75 0 101.448.389A5.5 5.5 0 0113.89 6.11l.311.31h-2.432a.75.75 0 000 1.5h4.243a.75.75 0 00.53-.219z" clip-rule="evenodd" />
                        </svg>
                        Reset All
                      </button>
                      <button
                        type="button"
                        id="printBomBtn"
                        class="btn btn-secondary px-3 py-1 text-sm"
                      >
                        <svg
                          xmlns="http://www.w3.org/2000/svg"
                          viewBox="0 0 20 20"
                          fill="currentColor"
                          class="w-4 h-4 inline-block mr-1 align-text-bottom"
                        >
                          <path
                            fill-rule="evenodd"
                            d="M5 2.75C5 1.784 5.784 1 6.75 1h6.5c.966 0 1.75.784 1.75 1.75v3.552c.377.046.752.11 1.126.192.484.107.912.284 1.234.534a.75.75 0 0 1 0 1.244c-.322.25-.75.427-1.234.534a11.46 11.46 0 0 1-1.126.192v3.552c0 .966-.784 1.75-1.75 1.75h-6.5A1.75 1.75 0 0 1 5 14.25v-3.552a11.46 11.46 0 0 1-1.126-.192c-.484-.107-.912-.284-1.234-.534a.75.75 0 0 1 0-1.244c.322-.25.75-.427 1.234-.534A11.46 11.46 0 0 1 5 8.25V2.75Zm2.25 9.5a.75.75 0 0 0 .75.75h4a.75.75 0 0 0 .75-.75V8.75a.75.75 0 0 0-.75-.75h-4a.75.75 0 0 0-.75.75v3.5ZM5.28 3.22a.22.22 0 0 0-.221.28l.004.004a.753.753 0 0 0 .217.276V7.1a.75.75 0 0 0 .75.75h8.5a.75.75 0 0 0 .75-.75V3.78a.753.753 0 0 0 .217-.276l.004-.004a.22.22 0 0 0-.221-.28H5.28ZM3.5 7.875c0 .414.336.75.75.75h11.5a.75.75 0 0 0 .75-.75V4.125a.75.75 0 0 0-.75-.75H4.25a.75.75 0 0 0-.75.75v3.75Z"
                            clip-rule="evenodd"
                          />
                        </svg>
                        Print
                      </button>
                    </div>
                  </div>
                  <div class="overflow-x-auto">
                    <table class="w-full bom-table">
                      <thead>
                        <tr>
                          <th class="qty-col">Qty</th>
                          <th>Item</th>
                          <th>Description</th>
                          <th class="price-col">Unit Price</th>
                          <th class="price-col">Total Price</th>
                        </tr>
                      </thead>
                      <tbody id="bomTableBody"></tbody>
                    </table>
                  </div>
                </div>
              </div>

            </div>
          </div>
        </div>

        <!-- Decking Tab Content -->
        <div
          id="decking-content"
          class="tab-content"
          role="tabpanel"
          aria-labelledby="decking-tab"
        >
          <div id="decking-layout-container" class="flex flex-col lg:flex-row gap-8">
            <div id="decking-input-panel" class="lg:w-1/4">
              <div class="info-card">
                <div class="coming-soon-content">
                  <div class="coming-soon-icon">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                      <rect x="3" y="3" width="18" height="18" rx="2" ry="2"/>
                      <line x1="9" y1="9" x2="15" y2="15"/>
                      <line x1="15" y1="9" x2="9" y2="15"/>
                    </svg>
                  </div>
                  <h3 class="coming-soon-title">Decking Controls</h3>
                  <p class="coming-soon-description">
                    Interactive controls for deck board planning, pattern selection, and material calculations.
                  </p>
                </div>
              </div>
            </div>

            <div id="decking-content-panel" class="lg:w-3/4">
              <div class="info-card">
                <div class="coming-soon-content">
                <div class="coming-soon-icon">
                  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <rect x="3" y="3" width="18" height="18" rx="2" ry="2"/>
                    <line x1="9" y1="9" x2="15" y2="15"/>
                    <line x1="15" y1="9" x2="9" y2="15"/>
                  </svg>
                </div>
                <h3 class="coming-soon-title">Decking Calculator</h3>
                <p class="coming-soon-description">
                  Plan your deck boards, patterns, and finishes. Calculate material quantities for various decking materials including composite, cedar, and pressure treated lumber.
                </p>
                
                <div class="preview-section">
                  <h4 class="preview-title">What's Coming</h4>
                  <ul class="preview-list">
                    <li>Visual deck board layout planner</li>
                    <li>Multiple pattern options (straight, diagonal, herringbone)</li>
                    <li>Material comparison tool (composite vs wood)</li>
                    <li>Waste calculation with cutting optimization</li>
                    <li>Cost estimation for different board types</li>
                    <li>Fastener and accessory calculations</li>
                  </ul>
                </div>
                
                <div class="coming-soon-features">
                  <span class="feature-tag">Board Layouts</span>
                  <span class="feature-tag">Pattern Planning</span>
                  <span class="feature-tag">Material Calculator</span>
                  <span class="feature-tag">Waste Estimation</span>
                  <span class="feature-tag">Cost Comparison</span>
                  <span class="feature-tag">Cut Optimization</span>
                </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Railing Tab Content -->
        <div
          id="railing-content"
          class="tab-content"
          role="tabpanel"
          aria-labelledby="railing-tab"
        >
          <div id="railing-layout-container" class="flex flex-col lg:flex-row gap-8">
            <div id="railing-input-panel" class="lg:w-1/4">
              <div class="info-card">
                <div class="coming-soon-content">
                  <div class="coming-soon-icon">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                      <line x1="3" y1="6" x2="21" y2="6"/>
                      <line x1="3" y1="12" x2="21" y2="12"/>
                      <line x1="3" y1="18" x2="21" y2="18"/>
                    </svg>
                  </div>
                  <h3 class="coming-soon-title">Railing Controls</h3>
                  <p class="coming-soon-description">
                    Code-compliant railing design tools and material selection controls.
                  </p>
                </div>
              </div>
            </div>

            <div id="railing-content-panel" class="lg:w-3/4">
              <div class="info-card">
                <div class="coming-soon-content">
                <div class="coming-soon-icon">
                  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <line x1="3" y1="6" x2="21" y2="6"/>
                    <line x1="3" y1="12" x2="21" y2="12"/>
                    <line x1="3" y1="18" x2="21" y2="18"/>
                  </svg>
                </div>
                <h3 class="coming-soon-title">Railing System</h3>
                <p class="coming-soon-description">
                  Design and calculate railing systems including posts, top rails, bottom rails, balusters, and hardware for code-compliant deck railings.
                </p>
                
                <div class="preview-section">
                  <h4 class="preview-title">What's Coming</h4>
                  <ul class="preview-list">
                    <li>Automatic code compliance checking (IRC/IBC)</li>
                    <li>Interactive railing designer with visual preview</li>
                    <li>Smart baluster spacing calculator</li>
                    <li>Gate placement and hardware planning</li>
                    <li>Multiple railing style options</li>
                    <li>Integrated lighting and accessory planning</li>
                  </ul>
                </div>
                
                <div class="coming-soon-features">
                  <span class="feature-tag">Code Compliance</span>
                  <span class="feature-tag">Baluster Spacing</span>
                  <span class="feature-tag">Post Placement</span>
                  <span class="feature-tag">Hardware List</span>
                  <span class="feature-tag">Gate Planning</span>
                  <span class="feature-tag">Style Options</span>
                </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Enhanced Summary Tab Content -->
        <div
          id="summary-content"
          class="tab-content"
          role="tabpanel"
          aria-labelledby="summary-tab"
        >
          <div id="summary-layout-container" class="flex flex-col lg:flex-row gap-8">
            <div id="summary-input-panel" class="lg:w-1/4">
              <div class="info-card">
                <div class="coming-soon-content">
                  <div class="coming-soon-icon">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                      <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
                      <polyline points="14,2 14,8 20,8"/>
                      <line x1="16" y1="13" x2="8" y2="13"/>
                      <line x1="16" y1="17" x2="8" y2="17"/>
                      <polyline points="10,9 9,9 8,9"/>
                    </svg>
                  </div>
                  <h3 class="coming-soon-title">Summary Controls</h3>
                  <p class="coming-soon-description">
                    Report customization, export options, and project management tools.
                  </p>
                </div>
              </div>
            </div>

            <div id="summary-content-panel" class="lg:w-3/4">
              <div class="info-card">
                <div class="coming-soon-content">
                <div class="coming-soon-icon">
                  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
                    <polyline points="14,2 14,8 20,8"/>
                    <line x1="16" y1="13" x2="8" y2="13"/>
                    <line x1="16" y1="17" x2="8" y2="17"/>
                    <polyline points="10,9 9,9 8,9"/>
                  </svg>
                </div>
                <h3 class="coming-soon-title">Enhanced Project Summary</h3>
                <p class="coming-soon-description">
                  Comprehensive project overview combining structure, decking, and railing with cost estimates, timeline planning, and professional PDF reports.
                </p>
                
                <div class="preview-section">
                  <h4 class="preview-title">What's Coming</h4>
                  <ul class="preview-list">
                    <li>Combined materials list from all project phases</li>
                    <li>Detailed cost breakdown with supplier pricing</li>
                    <li>Project timeline with construction phases</li>
                    <li>Professional PDF report generation</li>
                    <li>3D visualization and renderings</li>
                    <li>Permit application assistance</li>
                  </ul>
                </div>
                
                <div class="coming-soon-features">
                  <span class="feature-tag">Complete BOM</span>
                  <span class="feature-tag">Cost Estimates</span>
                  <span class="feature-tag">PDF Export</span>
                  <span class="feature-tag">Timeline Planning</span>
                  <span class="feature-tag">3D Visualization</span>
                  <span class="feature-tag">Permit Docs</span>
                </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Structural Specifications Modal -->
    <div id="specsModal" class="specs-modal hidden" onclick="if(event.target === this) closeSpecsModal()">
      <div class="specs-modal-content">
        <div class="specs-modal-header">
          <div class="specs-modal-title">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-6 h-6 text-[var(--tuds-green-dark)]">
              <path fill-rule="evenodd" d="M16.403 12.652a3 3 0 000-5.304 3 3 0 00-3.75-3.751 3 3 0 00-5.305 0 3 3 0 00-3.751 3.75 3 3 0 000 5.305 3 3 0 003.75 3.751 3 3 0 005.305 0 3 3 0 003.751-3.75zm-2.546-4.46a.75.75 0 00-1.214-.883l-3.483 4.79-1.88-1.88a.75.75 0 10-1.06 1.061l2.5 2.5a.75.75 0 001.137-.089l4-5.5z" clip-rule="evenodd" />
            </svg>
            <h2>Structural Specifications</h2>
            <span class="permit-badge">Permit-Ready</span>
          </div>
          <button type="button" class="specs-modal-close" onclick="closeSpecsModal()" title="Close">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-5 h-5">
              <path d="M6.28 5.22a.75.75 0 00-1.06 1.06L8.94 10l-3.72 3.72a.75.75 0 101.06 1.06L10 11.06l3.72 3.72a.75.75 0 101.06-1.06L11.06 10l3.72-3.72a.75.75 0 00-1.06-1.06L10 8.94 6.28 5.22z" />
            </svg>
          </button>
        </div>

        <p class="structural-specs-intro">
          Reference specifications for building permit applications. Verify all requirements with your local building authority.
        </p>

        <div class="specs-modal-body">
          <div class="structural-specs-grid">
            <!-- Design Loads -->
            <div class="spec-card">
              <div class="spec-card-header">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="spec-icon">
                  <path d="M10.75 10.818v2.614A3.13 3.13 0 0011.888 13c.482-.315.612-.648.612-.875 0-.227-.13-.56-.612-.875a3.13 3.13 0 00-1.138-.432zM8.33 8.62c.053.055.115.11.184.164.208.16.46.284.736.363V6.603a2.45 2.45 0 00-.35.13c-.14.065-.27.143-.386.233-.377.292-.514.627-.514.909 0 .184.058.39.202.592.037.051.08.102.128.152z" />
                  <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-8-6a.75.75 0 01.75.75v.316a3.78 3.78 0 011.653.713c.426.33.744.74.925 1.2a.75.75 0 01-1.395.55 1.35 1.35 0 00-.447-.563 2.187 2.187 0 00-.736-.363V9.3c.698.093 1.383.32 1.959.696.787.514 1.29 1.27 1.29 2.13 0 .86-.504 1.616-1.29 2.13-.576.377-1.261.603-1.96.696v.299a.75.75 0 11-1.5 0v-.3c-.697-.092-1.382-.318-1.958-.695-.482-.315-.857-.717-1.078-1.188a.75.75 0 111.359-.636c.08.173.245.376.54.569.313.205.706.353 1.137.432v-2.748a3.782 3.782 0 01-1.653-.713C6.9 9.433 6.5 8.681 6.5 7.875c0-.805.4-1.558 1.088-2.066.27-.199.576-.356.912-.47V5.045a.75.75 0 01.75-.75c.41 0 .75.336.75.75z" clip-rule="evenodd" />
                </svg>
                <h3>Design Loads</h3>
              </div>
              <div class="spec-card-content">
                <div class="spec-row">
                  <span class="spec-label">Live Load (People/Furniture)</span>
                  <span class="spec-value" id="specLiveLoad">40 PSF</span>
                </div>
                <div class="spec-row">
                  <span class="spec-label">Dead Load (Structure)</span>
                  <span class="spec-value" id="specDeadLoad">10 PSF</span>
                </div>
                <div class="spec-row highlight">
                  <span class="spec-label">Total Design Load</span>
                  <span class="spec-value" id="specTotalLoad">50 PSF</span>
                </div>
                <div class="spec-note">
                  Based on IRC R507.1 residential deck requirements
                </div>
              </div>
            </div>

            <!-- Joist Specifications -->
            <div class="spec-card">
              <div class="spec-card-header">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="spec-icon">
                  <path d="M3.75 3a.75.75 0 00-.75.75v12.5c0 .414.336.75.75.75h12.5a.75.75 0 00.75-.75V3.75a.75.75 0 00-.75-.75H3.75zM5.5 5.5h9v9h-9v-9z" />
                </svg>
                <h3>Joist System</h3>
              </div>
              <div class="spec-card-content">
                <div class="spec-row">
                  <span class="spec-label">Joist Size</span>
                  <span class="spec-value" id="specJoistSize">--</span>
                </div>
                <div class="spec-row">
                  <span class="spec-label">Spacing (O.C.)</span>
                  <span class="spec-value" id="specJoistSpacing">--</span>
                </div>
                <div class="spec-row">
                  <span class="spec-label">Actual Span</span>
                  <span class="spec-value" id="specJoistActualSpan">--</span>
                </div>
                <div class="spec-row compliance">
                  <span class="spec-label">Max Allowable Span</span>
                  <span class="spec-value" id="specJoistMaxSpan">--</span>
                </div>
                <div class="spec-compliance-status" id="joistComplianceStatus">
                  <span class="compliance-icon"></span>
                  <span class="compliance-text">Calculating...</span>
                </div>
              </div>
            </div>

            <!-- Beam Specifications -->
            <div class="spec-card">
              <div class="spec-card-header">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="spec-icon">
                  <path fill-rule="evenodd" d="M4.25 2A2.25 2.25 0 002 4.25v11.5A2.25 2.25 0 004.25 18h11.5A2.25 2.25 0 0018 15.75V4.25A2.25 2.25 0 0015.75 2H4.25zM15 5.75a.75.75 0 00-1.5 0v8.5a.75.75 0 001.5 0v-8.5zm-8.5 6a.75.75 0 00-1.5 0v2.5a.75.75 0 001.5 0v-2.5zM8.584 9a.75.75 0 01.75.75v4.5a.75.75 0 01-1.5 0v-4.5a.75.75 0 01.75-.75zm3.58-1.25a.75.75 0 00-1.5 0v6.5a.75.75 0 001.5 0v-6.5z" clip-rule="evenodd" />
                </svg>
                <h3>Beam System</h3>
              </div>
              <div class="spec-card-content">
                <div class="spec-row">
                  <span class="spec-label">Beam Configuration</span>
                  <span class="spec-value" id="specBeamConfig">--</span>
                </div>
                <div class="spec-row">
                  <span class="spec-label">Beam Type</span>
                  <span class="spec-value" id="specBeamType">--</span>
                </div>
                <div class="spec-row">
                  <span class="spec-label">Total Beam Length</span>
                  <span class="spec-value" id="specBeamLength">--</span>
                </div>
                <div class="spec-row">
                  <span class="spec-label">Number of Beams</span>
                  <span class="spec-value" id="specBeamCount">--</span>
                </div>
              </div>
            </div>

            <!-- Post & Foundation -->
            <div class="spec-card">
              <div class="spec-card-header">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="spec-icon">
                  <path fill-rule="evenodd" d="M9.674 2.075a.75.75 0 01.652 0l7.25 3.5A.75.75 0 0117 6.957V16.5h.25a.75.75 0 010 1.5H2.75a.75.75 0 010-1.5H3V6.957a.75.75 0 01-.576-1.382l7.25-3.5zM11 6a1 1 0 11-2 0 1 1 0 012 0zM7.5 9.75a.75.75 0 00-1.5 0v5.5a.75.75 0 001.5 0v-5.5zm3.25-.75a.75.75 0 01.75.75v5.5a.75.75 0 01-1.5 0v-5.5a.75.75 0 01.75-.75zm3.25.75a.75.75 0 00-1.5 0v5.5a.75.75 0 001.5 0v-5.5z" clip-rule="evenodd" />
                </svg>
                <h3>Posts & Foundations</h3>
              </div>
              <div class="spec-card-content">
                <div class="spec-row">
                  <span class="spec-label">Post Size</span>
                  <span class="spec-value" id="specPostSize">--</span>
                </div>
                <div class="spec-row">
                  <span class="spec-label">Post Height</span>
                  <span class="spec-value" id="specPostHeight">--</span>
                </div>
                <div class="spec-row">
                  <span class="spec-label">Number of Posts</span>
                  <span class="spec-value" id="specPostCount">--</span>
                </div>
                <div class="spec-row">
                  <span class="spec-label">Max Post Spacing</span>
                  <span class="spec-value" id="specPostSpacing">8' O.C.</span>
                </div>
                <div class="spec-row">
                  <span class="spec-label">Footing Type</span>
                  <span class="spec-value" id="specFootingType">--</span>
                </div>
                <div class="spec-row">
                  <span class="spec-label">Number of Footings</span>
                  <span class="spec-value" id="specFootingCount">--</span>
                </div>
              </div>
            </div>

            <!-- Ledger Attachment -->
            <div class="spec-card">
              <div class="spec-card-header">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="spec-icon">
                  <path d="M10 1a6 6 0 00-3.815 10.631C7.237 12.5 8 13.443 8 14.456v.644a.75.75 0 00.572.729 6.016 6.016 0 002.856 0A.75.75 0 0012 15.1v-.644c0-1.013.762-1.957 1.815-2.825A6 6 0 0010 1zM8.863 17.414a.75.75 0 00-.226 1.483 9.066 9.066 0 002.726 0 .75.75 0 00-.226-1.483 7.553 7.553 0 01-2.274 0z" />
                </svg>
                <h3>Attachment Method</h3>
              </div>
              <div class="spec-card-content">
                <div class="spec-row">
                  <span class="spec-label">Attachment Type</span>
                  <span class="spec-value" id="specAttachmentType">--</span>
                </div>
                <div class="spec-row">
                  <span class="spec-label">Ledger Size</span>
                  <span class="spec-value" id="specLedgerSize">--</span>
                </div>
                <div class="spec-row">
                  <span class="spec-label">Ledger Length</span>
                  <span class="spec-value" id="specLedgerLength">--</span>
                </div>
                <div class="spec-note" id="specLedgerNote">
                  Ledger attachment per IRC R507.9.1
                </div>
              </div>
            </div>

            <!-- Code References -->
            <div class="spec-card code-references">
              <div class="spec-card-header">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="spec-icon">
                  <path fill-rule="evenodd" d="M4.5 2A1.5 1.5 0 003 3.5v13A1.5 1.5 0 004.5 18h11a1.5 1.5 0 001.5-1.5V7.621a1.5 1.5 0 00-.44-1.06l-4.12-4.122A1.5 1.5 0 0011.378 2H4.5zm2.25 8.5a.75.75 0 000 1.5h6.5a.75.75 0 000-1.5h-6.5zm0 3a.75.75 0 000 1.5h6.5a.75.75 0 000-1.5h-6.5z" clip-rule="evenodd" />
                </svg>
                <h3>Code References</h3>
              </div>
              <div class="spec-card-content">
                <ul class="code-reference-list">
                  <li><strong>IRC R507</strong> - Exterior Decks</li>
                  <li><strong>IRC R507.5</strong> - Deck Joists</li>
                  <li><strong>IRC R507.6</strong> - Deck Beams</li>
                  <li><strong>IRC R507.8</strong> - Deck Posts</li>
                  <li><strong>IRC R507.9</strong> - Deck Ledger Board</li>
                </ul>
                <div class="spec-disclaimer">
                  Always verify specifications with your local building department. Code requirements vary by jurisdiction.
                </div>
              </div>
            </div>
          </div>
        </div>

        <div class="specs-modal-footer">
          <button type="button" id="printSpecsBtn" class="btn btn-secondary px-4 py-2 text-sm" onclick="window.print()">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-4 h-4 inline-block mr-1.5 align-text-bottom">
              <path fill-rule="evenodd" d="M5 2.75C5 1.784 5.784 1 6.75 1h6.5c.966 0 1.75.784 1.75 1.75v3.552c.377.046.752.11 1.126.192.484.107.912.284 1.234.534a.75.75 0 010 1.244c-.322.25-.75.427-1.234.534a11.46 11.46 0 01-1.126.192v3.552c0 .966-.784 1.75-1.75 1.75h-6.5A1.75 1.75 0 015 14.25v-3.552a11.46 11.46 0 01-1.126-.192c-.484-.107-.912-.284-1.234-.534a.75.75 0 010-1.244c.322-.25.75-.427 1.234-.534A11.46 11.46 0 015 8.25V2.75z" clip-rule="evenodd" />
            </svg>
            Print Specifications
          </button>
          <button type="button" class="btn btn-primary px-4 py-2 text-sm" onclick="closeSpecsModal()">
            Close
          </button>
        </div>
      </div>
    </div>

    <!-- Cut List Modal -->
    <div id="cutListModal" class="cut-list-modal hidden" onclick="if(event.target === this) closeCutListModal()">
      <div class="cut-list-modal-content">
        <div class="cut-list-modal-header">
          <div class="cut-list-modal-title">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-6 h-6 text-[var(--tuds-green-dark)]">
              <path fill-rule="evenodd" d="M4.5 2A1.5 1.5 0 003 3.5v13A1.5 1.5 0 004.5 18h11a1.5 1.5 0 001.5-1.5V7.621a1.5 1.5 0 00-.44-1.06l-4.12-4.122A1.5 1.5 0 0011.378 2H4.5zM6 7a.75.75 0 000 1.5h8A.75.75 0 0014 7H6zm0 3.5a.75.75 0 000 1.5h8a.75.75 0 000-1.5H6zm0 3.5a.75.75 0 000 1.5h5a.75.75 0 000-1.5H6z" clip-rule="evenodd" />
            </svg>
            <h2>Framing Cut List</h2>
            <span class="cut-list-badge">For Construction</span>
          </div>
          <button type="button" class="cut-list-modal-close" onclick="closeCutListModal()" title="Close">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-5 h-5">
              <path d="M6.28 5.22a.75.75 0 00-1.06 1.06L8.94 10l-3.72 3.72a.75.75 0 101.06 1.06L10 11.06l3.72 3.72a.75.75 0 101.06-1.06L11.06 10l3.72-3.72a.75.75 0 00-1.06-1.06L10 8.94 6.28 5.22z" />
            </svg>
          </button>
        </div>

        <p class="cut-list-intro">
          Detailed lumber cut list with component labels matching the diagram. Print for easy reference during construction.
        </p>

        <div class="cut-list-modal-body">
          <!-- Summary Stats -->
          <div class="cut-list-summary">
            <div class="cut-list-stat">
              <span class="stat-value" id="cutListTotalPieces">0</span>
              <span class="stat-label">Total Pieces</span>
            </div>
            <div class="cut-list-stat">
              <span class="stat-value" id="cutListTotalLF">0</span>
              <span class="stat-label">Linear Feet</span>
            </div>
            <div class="cut-list-stat">
              <span class="stat-value" id="cutListUniqueTypes">0</span>
              <span class="stat-label">Unique Sizes</span>
            </div>
          </div>

          <!-- Cut List Table -->
          <div class="cut-list-table-container">
            <table class="cut-list-table">
              <thead>
                <tr>
                  <th class="label-col">Label</th>
                  <th class="type-col">Component</th>
                  <th class="size-col">Size</th>
                  <th class="length-col">Length</th>
                  <th class="qty-col">Qty</th>
                </tr>
              </thead>
              <tbody id="cutListTableBody">
                <!-- Cut list items will be populated here -->
              </tbody>
            </table>
          </div>

          <!-- Grouped by size summary -->
          <div class="cut-list-grouped">
            <h3>Summary by Size</h3>
            <div id="cutListGroupedContent">
              <!-- Grouped summary will be populated here -->
            </div>
          </div>
        </div>

        <div class="cut-list-modal-footer">
          <button type="button" id="printCutListBtn" class="btn btn-secondary px-4 py-2 text-sm" onclick="printCutList()">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-4 h-4 inline-block mr-1.5 align-text-bottom">
              <path fill-rule="evenodd" d="M5 2.75C5 1.784 5.784 1 6.75 1h6.5c.966 0 1.75.784 1.75 1.75v3.552c.377.046.752.11 1.126.192.484.107.912.284 1.234.534a.75.75 0 010 1.244c-.322.25-.75.427-1.234.534a11.46 11.46 0 01-1.126.192v3.552c0 .966-.784 1.75-1.75 1.75h-6.5A1.75 1.75 0 015 14.25v-3.552a11.46 11.46 0 01-1.126-.192c-.484-.107-.912-.284-1.234-.534a.75.75 0 010-1.244c.322-.25.75-.427 1.234-.534A11.46 11.46 0 015 8.25V2.75z" clip-rule="evenodd" />
            </svg>
            Print Cut List
          </button>
          <button type="button" class="btn btn-primary px-4 py-2 text-sm" onclick="closeCutListModal()">
            Close
          </button>
        </div>
      </div>
    </div>

    <!-- 3D Preview Modal -->
    <div id="preview3DModal" class="preview3d-modal hidden" onclick="if(event.target === this) close3DPreview()">
      <div class="preview3d-modal-content">
        <div class="preview3d-modal-header">
          <div class="preview3d-modal-title">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-6 h-6 text-[var(--tuds-green-dark)]">
              <path d="M10 3.5a1.5 1.5 0 013 0V4a1 1 0 001 1h3a1 1 0 011 1v3a1 1 0 01-1 1h-.5a1.5 1.5 0 000 3h.5a1 1 0 011 1v3a1 1 0 01-1 1h-3a1 1 0 01-1-1v-.5a1.5 1.5 0 00-3 0v.5a1 1 0 01-1 1H6a1 1 0 01-1-1v-3a1 1 0 00-1-1h-.5a1.5 1.5 0 010-3H4a1 1 0 001-1V6a1 1 0 011-1h3a1 1 0 001-1v-.5z" />
            </svg>
            <h2>3D Preview</h2>
            <span class="preview3d-badge">Isometric View</span>
          </div>
          <button type="button" class="preview3d-modal-close" onclick="close3DPreview()" title="Close">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-5 h-5">
              <path d="M6.28 5.22a.75.75 0 00-1.06 1.06L8.94 10l-3.72 3.72a.75.75 0 101.06 1.06L10 11.06l3.72 3.72a.75.75 0 101.06-1.06L11.06 10l3.72-3.72a.75.75 0 00-1.06-1.06L10 8.94 6.28 5.22z" />
            </svg>
          </button>
        </div>

        <div class="preview3d-controls">
          <div class="preview3d-control-group">
            <label>View Angle</label>
            <div class="preview3d-angle-btns">
              <button type="button" class="angle-btn active" data-angle="front-right" onclick="set3DAngle('front-right')">Front-Right</button>
              <button type="button" class="angle-btn" data-angle="front-left" onclick="set3DAngle('front-left')">Front-Left</button>
              <button type="button" class="angle-btn" data-angle="back-right" onclick="set3DAngle('back-right')">Back-Right</button>
              <button type="button" class="angle-btn" data-angle="back-left" onclick="set3DAngle('back-left')">Back-Left</button>
            </div>
          </div>
          <div class="preview3d-control-group">
            <label>Show Layers</label>
            <div class="preview3d-layer-toggles">
              <label class="layer-toggle"><input type="checkbox" id="show3d-decking" checked onchange="update3DPreview()"><span>Decking</span></label>
              <label class="layer-toggle"><input type="checkbox" id="show3d-joists" checked onchange="update3DPreview()"><span>Joists</span></label>
              <label class="layer-toggle"><input type="checkbox" id="show3d-beams" checked onchange="update3DPreview()"><span>Beams</span></label>
              <label class="layer-toggle"><input type="checkbox" id="show3d-posts" checked onchange="update3DPreview()"><span>Posts</span></label>
            </div>
          </div>
        </div>

        <div class="preview3d-modal-body">
          <canvas id="preview3DCanvas" width="800" height="600"></canvas>
          <div class="preview3d-info">
            <span id="preview3dDimensions">-</span>
          </div>
        </div>

        <div class="preview3d-modal-footer">
          <button type="button" class="btn btn-secondary px-4 py-2 text-sm" onclick="download3DPreview()">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-4 h-4 inline-block mr-1.5 align-text-bottom">
              <path d="M10.75 2.75a.75.75 0 00-1.5 0v8.614L6.295 8.235a.75.75 0 10-1.09 1.03l4.25 4.5a.75.75 0 001.09 0l4.25-4.5a.75.75 0 00-1.09-1.03l-2.955 3.129V2.75z" />
              <path d="M3.5 12.75a.75.75 0 00-1.5 0v2.5A2.75 2.75 0 004.75 18h10.5A2.75 2.75 0 0018 15.25v-2.5a.75.75 0 00-1.5 0v2.5c0 .69-.56 1.25-1.25 1.25H4.75c-.69 0-1.25-.56-1.25-1.25v-2.5z" />
            </svg>
            Download Image
          </button>
          <button type="button" class="btn btn-primary px-4 py-2 text-sm" onclick="close3DPreview()">
            Close
          </button>
        </div>
      </div>
    </div>

    <!-- Help Wizard Overlay -->
    <div id="helpWizardOverlay" class="help-wizard-overlay hidden">
      <!-- Spotlight highlight element -->
      <div id="wizardSpotlight" class="wizard-spotlight"></div>

      <!-- Tooltip container -->
      <div id="wizardTooltip" class="wizard-tooltip">
        <div class="wizard-tooltip-header">
          <span class="wizard-step-indicator" id="wizardStepIndicator">Step 1 of 8</span>
          <button type="button" class="wizard-close-btn" onclick="endHelpWizard()" title="Close tutorial">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-5 h-5">
              <path d="M6.28 5.22a.75.75 0 00-1.06 1.06L8.94 10l-3.72 3.72a.75.75 0 101.06 1.06L10 11.06l3.72 3.72a.75.75 0 101.06-1.06L11.06 10l3.72-3.72a.75.75 0 00-1.06-1.06L10 8.94 6.28 5.22z" />
            </svg>
          </button>
        </div>
        <div class="wizard-tooltip-content">
          <h3 id="wizardTitle" class="wizard-title">Welcome to TUDS Pro Deck Estimator</h3>
          <p id="wizardDescription" class="wizard-description">Let's take a quick tour of the main features to help you get started.</p>
        </div>
        <div class="wizard-tooltip-footer">
          <button type="button" id="wizardPrevBtn" class="btn btn-secondary wizard-btn" onclick="prevWizardStep()">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-4 h-4">
              <path fill-rule="evenodd" d="M12.79 5.23a.75.75 0 01-.02 1.06L8.832 10l3.938 3.71a.75.75 0 11-1.04 1.08l-4.5-4.25a.75.75 0 010-1.08l4.5-4.25a.75.75 0 011.06.02z" clip-rule="evenodd" />
            </svg>
            Back
          </button>
          <div class="wizard-progress">
            <div id="wizardProgressDots" class="wizard-progress-dots"></div>
          </div>
          <button type="button" id="wizardNextBtn" class="btn btn-primary wizard-btn" onclick="nextWizardStep()">
            Next
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-4 h-4">
              <path fill-rule="evenodd" d="M7.21 14.77a.75.75 0 01.02-1.06L11.168 10 7.23 6.29a.75.75 0 111.04-1.08l4.5 4.25a.75.75 0 010 1.08l-4.5 4.25a.75.75 0 01-1.06-.02z" clip-rule="evenodd" />
            </svg>
          </button>
        </div>
        <div class="wizard-skip-link">
          <button type="button" class="wizard-skip-btn" onclick="endHelpWizard()">Skip tutorial</button>
        </div>
      </div>
    </div>
  </body>
</html>
